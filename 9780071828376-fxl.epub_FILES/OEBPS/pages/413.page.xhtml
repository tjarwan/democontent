<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml"><head><title/><link rel="stylesheet" href="../css/base.min.css"/><link rel="stylesheet" href="../css/fancy.min.css"/><link rel="stylesheet" href="../css/pdf.css"/><meta name="viewport" content="width=640, height=824"/></head><body><div id="page_body"><div id="pf19d" class="pf w2 h2" data-page-no="19d"><div class="pc pc19d w2 h2"><div class="t m0 xbe h10 y83 ff1 fs9 fc0 sc0 lsa ws0">390<span class="_ _d"> </span><span class="ff2 fs2 ls8">Advanced Persistent Threat Hacking<span class="_ _1e"/> </span></div><div class="t m0 x4 hd y11c ff4 fs7 fc0 sc0 ls0 ws0">Thus, the only thing we changed was the command page on the command-and-</div><div class="t m0 x3 hd y11d ff4 fs7 fc0 sc0 ls0 ws0">control server<span class="_ _2"/>, which instructs the dropper which les are to be downloaded and </div><div class="t m0 x3 hd y11e ff4 fs7 fc0 sc0 ls0 ws0">ex<span class="_ _0"/>ecuted. The logic of the dropper is e<span class="_ _0"/>xactly the same on the end-user machines and </div><div class="t m0 x3 hd y15c ff4 fs7 fc0 sc0 lsb ws16">the administrator machine. If the in<span class="_ _0"/>v<span class="_ _0"/>estigator took a hash of the dropper<span class="_ _0"/>.e<span class="_ _0"/>xe le, </div><div class="t m0 x3 hd y15d ff4 fs7 fc0 sc0 lsb ws16">it would be the same on all machines. <span class="_ _0"/>Thus, the in<span class="_ _0"/>vestigator belie<span class="_ _0"/>v<span class="_ _0"/>es the malware </div><div class="t m0 x3 hd y271 ff4 fs7 fc0 sc0 ls0 ws0">deployed was simple in nature and easy to clean, without realizing that prior to their </div><div class="t m0 x3 hd y272 ff4 fs7 fc0 sc0 lsb ws16">in<span class="_ _0"/>v<span class="_ _0"/>estigation, an additional backdoor with rootkit functionality was deployed on </div><div class="t m0 x3 hd y201c ff4 fs7 fc0 sc0 ls0 ws0">end-user machines.</div><div class="t m0 x4 hd y218f ff4 fs7 fc0 sc0 ls0 ws0">Kno<span class="_ _0"/>wing when to change the command page on the command-and-control server </div><div class="t m0 x3 hd y273 ff4 fs7 fc0 sc0 ls0 ws0">is the only trick for us here. In the simplest case, if we are performing a targeted </div><div class="t m0 x3 hd y274 ff4 fs7 fc0 sc0 lsb ws16">attack against a single indi<span class="_ _0"/>vidual user<span class="_ _0"/>, then we simply change the conguration after </div><div class="t m0 x3 hd y275 ff4 fs7 fc0 sc0 ls0 ws0">the rst deployment. <span class="_ _2"/>After one deployment of our backdoor<span class="_ _0"/>, we kno<span class="_ _0"/>w that any other </div><div class="t m0 x3 hd y276 ff4 fs7 fc0 sc0 lsb ws16">attempts to install or run the dropper program could be indicati<span class="_ _0"/>ve of an in<span class="_ _0"/>v<span class="_ _0"/>estigation.</div><div class="t m0 x4 hd y277 ff4 fs7 fc0 sc0 ls0 ws0">K<span class="_ _0"/>eep in mind this is just one example. <span class="_ _0"/>W<span class="_ _3"/>e can get extremely creati<span class="_ _0"/>ve here </div><div class="t m0 x3 hd y3b3 ff4 fs7 fc0 sc0 lsb ws16">kno<span class="_ _0"/>wing what responders will see when in<span class="_ _0"/>vestigating the dropper and ho<span class="_ _0"/>w the<span class="_ _0"/>y </div><div class="t m0 x3 hd y3b4 ff4 fs7 fc0 sc0 ls0 ws0">will likely react to that information. F<span class="_ _0"/>or example, rather than making this a manual </div><div class="t m0 x3 hd y27a ff4 fs7 fc0 sc0 ls0 ws0">process of changing the command-and-control server<span class="_ _2"/>, we could dynamically choose </div><div class="t m0 x3 hd y27b ff4 fs7 fc0 sc0 ls0 ws0">when to stop serving up the rootkit.ex<span class="_ _0"/>e program from our command-and-control </div><div class="t m0 x3 hd y27c ff4 fs7 fc0 sc0 ls0 ws0">server<span class="_ _2"/>. <span class="_ _2"/>A few examples of things we could use to mak<span class="_ _0"/>e this decision include</div><div class="t m0 x16 h1f y24d3 ffb fse fc0 sc0 ls0 ws0">c</div><div class="t m0 x1 hd y24d4 ff4 fs7 fc0 sc0 ls0 ws0">Send group membership information as part of the HTTP request to our </div><div class="t m0 x1 hd y24d5 ff4 fs7 fc0 sc0 ls0 ws0">C2 server</div><div class="t m0 x1 h1f y24d6 ffb fse fc0 sc0 ls0 ws0">c</div><div class="t m0 x94 hd y24d7 ff4 fs7 fc0 sc0 ls0 ws0">If local administrator<span class="_ _0"/>, domain administrator<span class="_ _0"/>, or member of an<span class="_ _0"/>y “technical” </div><div class="t m0 x94 hd y24d8 ff4 fs7 fc0 sc0 ls0 ws0">group, for example, “helpdesk”</div><div class="t m0 x16 h1f y24d9 ffb fse fc0 sc0 ls0 ws0">c</div><div class="t m0 x1 hd y24da ff4 fs7 fc0 sc0 ls0 ws0">Check if computer is a virtual machine</div><div class="t m0 x1 h1f y24db ffb fse fc0 sc0 ls0 ws0">c</div><div class="t m0 x94 hd y24dc ff4 fs7 fc0 sc0 ls0 ws0">Check MA<span class="_ _0"/>C address, check for e<span class="_ _0"/>xistence of virtual “guest” additions</div><div class="t m0 x16 h1f y24dd ffb fse fc0 sc0 ls0 ws0">c</div><div class="t m0 x1 hd y24de ff4 fs7 fc0 sc0 ls0 ws0">Check source IP address of communications</div><div class="t m0 x1 h1f y24df ffb fse fc0 sc0 ls0 ws0">c</div><div class="t m0 x94 hd y24e0 ff4 fs7 fc0 sc0 ls0 ws0">For e<span class="_ _0"/>xample, we’<span class="_ _0"/>re tar<span class="_ _0"/>geting remote users and all technical users are at </div><div class="t m0 x94 hd y24e1 ff4 fs7 fc0 sc0 ls0 ws0">headquarters</div><div class="t m0 x16 h1f y24e2 ffb fse fc0 sc0 ls0 ws0">c</div><div class="t m0 x1 hd y24e3 ff4 fs7 fc0 sc0 lsb ws16">Check username against a list of kno<span class="_ _0"/>wn technical support personnel (known </div><div class="t m0 x1 hd y24e4 ff4 fs7 fc0 sc0 ls0 ws0">from recon)</div><div class="t m0 x4 hd y24e5 ff4 fs7 fc0 sc0 ls0 ws0">Of course, some of this is predicated on us being able to trust the information sent </div><div class="t m0 x3 hd y24e6 ff4 fs7 fc0 sc0 ls0 ws0">back to us, but I digress. <span class="_ _2"/>As usual you’ll ha<span class="_ _0"/>ve to look at the conte<span class="_ _0"/>xt of your backdoor </div><div class="t m0 x3 hd y24e7 ff4 fs7 fc0 sc0 ls0 ws0">deployment to determine ho<span class="_ _0"/>w and when to adjust the operation of your droppers </div><div class="t m0 x3 hd y24e8 ff4 fs7 fc0 sc0 ls0 ws0">and backdoors. <span class="_ _0"/>W<span class="_ _3"/>e’ll discuss methods for sending information surreptitiously to </div><div class="t m0 x3 hd y24e9 ff4 fs7 fc0 sc0 lsb ws16">our C2 server shortly<span class="_ _3"/>. By utilizing methods to detect inv<span class="_ _0"/>estigation acti<span class="_ _0"/>vities on a </div><div class="t m0 x3 hd y24ea ff4 fs7 fc0 sc0 lsb ws16">compromised system, as well as any ofine in<span class="_ _2"/>vestigation of our backdoor from a </div></div><div class="pi" data-data="{&#34;ctm&#34;:[1.209373,0.000000,0.000000,1.209373,0.000000,0.000000]}"/></div></div></body></html>