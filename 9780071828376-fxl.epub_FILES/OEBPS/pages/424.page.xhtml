<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml"><head><title/><link rel="stylesheet" href="../css/base.min.css"/><link rel="stylesheet" href="../css/fancy.min.css"/><link rel="stylesheet" href="../css/pdf.css"/><meta name="viewport" content="width=640, height=824"/></head><body><div id="page_body"><div id="pf1a8" class="pf w2 h2" data-page-no="1a8"><div class="pc pc1a8 w2 h2"><div class="t m0 x6 h10 y83 ff2 fs2 fc0 sc0 ls8 ws0">Chapter 10: APT Software Backdoors<span class="_ _9"> </span><span class="ff1 fs9 lsa">401</span></div><div class="t m0 x3 h4 y2c9 ff2 fs1 fc0 sc0 ls0 ws0">Backdoor Command and Control</div><div class="t m0 x3 hd y2ca ff4 fs7 fc0 sc0 ls0 ws0">Getting our backdoor to communicate with our command-and-control server is a </div><div class="t m0 x3 hd y2cb ff4 fs7 fc0 sc0 ls0 ws0">straightforward task. Man<span class="_ _0"/>y backdoors use the IRC system; howe<span class="_ _0"/>v<span class="_ _0"/>er<span class="_ _0"/>, we’ll stick with </div><div class="t m0 x3 hd y2cc ff4 fs7 fc0 sc0 ls0 ws0">HTTP as our core protocol of choice, as this is much more likely to blend in with </div><div class="t m0 x3 hd y2cd ff4 fs7 fc0 sc0 ls0 ws0">normal user acti<span class="_ _0"/>vity and should help us maintain stealth operation.</div><div class="t m0 x4 hd y11e2 ff4 fs7 fc0 sc0 ls0 ws0">At its most basic le<span class="_ _0"/>vel, we’ll simply hide precongured “commands” within </div><div class="t m0 x3 hd y2cf ff4 fs7 fc0 sc0 ls0 ws0">the HTML of an innocuous-looking web page; the backdoor will then perform </div><div class="t m0 x3 hd y2d0 ff4 fs7 fc0 sc0 ls0 ws0">precongured actions based on these commands. Based on the actions we need the </div><div class="t m0 x3 hd y2d1 ff4 fs7 fc0 sc0 ls0 ws0">backdoor to perform, we can make the commands e<span class="_ _0"/>xtremely hard to detect. For </div><div class="t m0 x3 hd y2d2 ff4 fs7 fc0 sc0 ls0 ws0">example, if we hardcode indi<span class="_ _0"/>vidual commands on the backdoor that do not require </div><div class="t m0 x3 hd y2d3 ff4 fs7 fc0 sc0 ls0 ws0">dynamic v<span class="_ _0"/>ariables to be specied then we can indicate these commands with specic </div><div class="t m0 x3 hd y2d4 ff4 fs7 fc0 sc0 ls0 ws0">sentences or dates within the le that are congruent with the content of the page this </div><div class="t m0 x3 hd y2d5 ff4 fs7 fc0 sc0 ls0 ws0">would be e<span class="_ _0"/>xtremely hard to detect.</div><div class="t m0 x4 hd y533 ff4 fs7 fc0 sc0 ls0 ws0">A fe<span class="_ _0"/>w common examples of actions to perform include</div><div class="t m0 x16 h1f y25fe ffb fse fc0 sc0 ls0 ws0">c</div><div class="t m0 x1 hd y25ff ff4 fs7 fc0 sc0 ls0 ws0">Do<span class="_ _0"/>wnloading additional les to the compromised computer</div><div class="t m0 x16 h1f y2600 ffb fse fc0 sc0 ls0 ws0">c</div><div class="t m0 x1 hd y2601 ff4 fs7 fc0 sc0 ls0 ws0">Uploading les to the command-and-control server</div><div class="t m0 x16 h1f y2602 ffb fse fc0 sc0 ls0 ws0">c</div><div class="t m0 x1 hd y2603 ff4 fs7 fc0 sc0 ls0 ws0">Providing interacti<span class="_ _0"/>v<span class="_ _0"/>e access to the compromised computer<span class="_ _0"/>, for example, </div><div class="t m0 x1 hd y2604 ff4 fs7 fc0 sc0 ls0 ws0">through a shell or cmd.ex<span class="_ _0"/>e</div><div class="t m0 x16 h1f y2605 ffb fse fc0 sc0 ls0 ws0">c</div><div class="t m0 x1 hd y2606 ff4 fs7 fc0 sc0 ls0 ws0">Running arbitrary or static commands</div><div class="t m0 x3 h7 y2607 ff1 fs3 fc0 sc0 ls0 ws0">Command and Control: Heartbeat</div><div class="t m0 x3 hd y2608 ff4 fs7 fc0 sc0 ls0 ws0">Remember that in many cases we don’<span class="_ _0"/>t e<span class="_ _0"/>ven need to send an<span class="_ _0"/>y substantial trafc </div><div class="t m0 x3 hd y2609 ff4 fs7 fc0 sc0 ls0 ws0">ov<span class="_ _0"/>er the HTTP tunnel in order to accomplish our goals for any specic task. F<span class="_ _0"/>or </div><div class="t m0 x3 hd y260a ff4 fs7 fc0 sc0 ls0 ws0">example, in this case, we merely w<span class="_ _0"/>ant to be made aware of when the backdoor has </div><div class="t m0 x3 hd y260b ff4 fs7 fc0 sc0 ls0 ws0">been initially installed on a ne<span class="_ _0"/>w system. <span class="_ _0"/>W<span class="_ _2"/>e can also use this same method as a way </div><div class="t m0 x3 hd y260c ff4 fs7 fc0 sc0 ls0 ws0">to ensure the backdoor is running by periodically requesting a specic URL from the </div><div class="t m0 x3 hd y260d ff4 fs7 fc0 sc0 ls0 ws0">backdoor<span class="_ _2"/>. That page on our C2 server can then log or alert us to the acti<span class="_ _0"/>vity<span class="_ _2"/>.</div><div class="t m0 x4 hd y260e ff4 fs7 fc0 sc0 ls0 ws0">T<span class="_ _3"/>o accomplish this, we’ll create the following function called backdoorHeartbeat:</div><div class="t m0 x3 h40 y260f fff fs5 fc0 sc0 ls0 ws0">int backdoorHeartbeat(void)</div><div class="t m0 x3 h40 y2610 fff fs5 fc0 sc0 ls0 ws0">{</div><div class="t m0 x3 h40 y2611 fff fs5 fc0 sc0 ls0 ws0">  CURL *curl;</div><div class="t m0 x3 h40 y2612 fff fs5 fc0 sc0 ls0 ws0">  CURLcode res;</div><div class="t m0 x3 h40 y2613 fff fs5 fc0 sc0 ls0 ws0">  char hostName[128];</div><div class="t m0 x3 h40 y2614 fff fs5 fc0 sc0 ls0 ws0">  char userName[128];</div></div><div class="pi" data-data="{&#34;ctm&#34;:[1.209373,0.000000,0.000000,1.209373,0.000000,0.000000]}"/></div></div></body></html>