<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml"><head><title/><link rel="stylesheet" href="../css/base.min.css"/><link rel="stylesheet" href="../css/fancy.min.css"/><link rel="stylesheet" href="../css/pdf.css"/><meta name="viewport" content="width=640, height=824"/></head><body><div id="page_body"><div id="pf119" class="pf w2 h2" data-page-no="119"><div class="pc pc119 w2 h2"><div class="t m0 xbe h10 y83 ff1 fs9 fc0 sc0 lsa ws0">258<span class="_ _d"> </span><span class="ff2 fs2 ls8">Advanced Persistent Threat Hacking<span class="_ _1e"/> </span></div><div class="t m0 x3 hd y11c ff4 fs7 fc0 sc0 ls0 ws0">the trafc, such as Xplico or NetworkMiner<span class="_ _2"/>. NetworkMiner is a win32 application </div><div class="t m0 x3 hd y11d ff4 fs7 fc0 sc0 ls0 ws0">that has a free version a<span class="_ _0"/>v<span class="_ _0"/>ailable. Xplico is an open-source, web-based application </div><div class="t m0 x3 hd y20f ff4 fs7 fc0 sc0 ls0 ws0">that can be installed easily within Kali. Both of these programs are good at breaking </div><div class="t m0 x3 hd y210 ff4 fs7 fc0 sc0 ls0 ws0">do<span class="_ _0"/>wn a lot of the data within a packet capture and allo<span class="_ _0"/>wing you to quickly vie<span class="_ _0"/>w </div><div class="t m0 x3 hd y211 ff4 fs7 fc0 sc0 ls0 ws0">interesting pieces of the communication.</div><div class="t m0 x3 h7 y1aef ff1 fs3 fc0 sc0 ls0 ws0">Protocol Manipulation</div><div class="t m0 x3 hd y2f0 ff4 fs7 fc0 sc0 lsf ws1b">W<span class="_ _3"/>e will also use the rewall functionality of our Linux host via iptables to determine </div><div class="t m0 x3 hd y99e ff4 fs7 fc0 sc0 lsf ws1b">which trafc we want to allo<span class="_ _0"/>w to the intended hosts and which we want to redirect to </div><div class="t m0 x3 hd y3e4 ff4 fs7 fc0 sc0 lsf ws1b">our host to be processed. This is particularly important if the client has an<span class="_ _0"/>y software </div><div class="t m0 x3 hd y1af0 ff4 fs7 fc0 sc0 lsf ws1b">that is congured with an IP address rather than a DNS hostname. Because the client </div><div class="t m0 x3 hd y1af1 ff4 fs7 fc0 sc0 lsf ws1b">won’<span class="_ _0"/>t be required to perform a hostname lookup, they’ll just send IP trafc directly </div><div class="t m0 x3 hd y1af2 ff4 fs7 fc0 sc0 lsf ws1b">to the congured IP address and our DNS server w<span class="_ _0"/>on’t be able to direct them to </div><div class="t m0 x3 hd y1af3 ff4 fs7 fc0 sc0 lsf ws1b">our rogue system. <span class="_ _2"/>A good example of this could be a Secure Sockets Layer (SSL) </div><div class="t m0 x3 hd y1af4 ff4 fs7 fc0 sc0 lsf ws1b">virtual pri<span class="_ _0"/>vate netw<span class="_ _0"/>ork (VPN) client agent. The agent might be congured with the </div><div class="t m0 x3 hd y1af5 ff4 fs7 fc0 sc0 lsf ws0">IP address of the organization’<span class="_ _2"/>s SSL <span class="_ _2"/>VPN server<span class="_ _0"/>, which will then attempt to connect </div><div class="t m0 x3 hd y1af6 ff4 fs7 fc0 sc0 ls10 ws16">to the organization’<span class="_ _2"/>s gate<span class="_ _0"/>way<span class="_ _2"/>, which we will redirect to our HTTP server<span class="_ _2"/>. In this </div><div class="t m0 x3 hd y1af7 ff4 fs7 fc0 sc0 lsf ws1b">scenario, the user will be prompted to accept an in<span class="_ _0"/>v<span class="_ _0"/>alid certicate, b<span class="_ _0"/>ut it’<span class="_ _0"/>s common </div><div class="t m0 x3 hd y1af8 ff4 fs7 fc0 sc0 lsf ws1b">for users to recei<span class="_ _0"/>ve this warning and click right through it. In f<span class="_ _0"/>act, I hav<span class="_ _0"/>e observed this </div><div class="t m0 x3 hd y1af9 ff4 fs7 fc0 sc0 lsf ws0">many times where an or<span class="_ _0"/>ganization’<span class="_ _2"/>s critical remote access systems, including SSL </div><div class="t m0 x3 hd y1afa ff4 fs7 fc0 sc0 ls10 ws16">VPN gate<span class="_ _0"/>ways, ha<span class="_ _0"/>ve self-signed certicates, thus desensitizing users to this warning!</div><div class="t m0 x4 hd y1afb ff4 fs7 fc0 sc0 ls16 ws0">The fact is that an almost innite number of systems could attempt to <span class="ls0">communicate </span></div><div class="t m0 x3 hd y1afc ff4 fs7 fc0 sc0 ls0 ws0">with a remote host directly<span class="_ _2"/>. W<span class="_ _3"/>e want to monitor for this acti<span class="_ _0"/>vity and identify any </div><div class="t m0 x3 hd y1afd ff4 fs7 fc0 sc0 ls0 ws0">systems that we can then target directly<span class="_ _3"/>.</div><div class="t m0 x4 hd y1afe ff4 fs7 fc0 sc0 ls12 ws0">Because all of the trafc is o<span class="_ _0"/>wing through our host, we can also rely on <span class="ls0">classic </span></div><div class="t m0 x3 hd y1aff ff4 fs7 fc0 sc0 ls1a ws0">network man-in-the-middle (MITM) tools such as ettercap to perform an<span class="_ _0"/>y <span class="ls0">manipulation </span></div><div class="t m0 x3 hd y1b00 ff4 fs7 fc0 sc0 ls0 ws0">or mangling of network packets. Ho<span class="_ _0"/>we<span class="_ _0"/>v<span class="_ _0"/>er<span class="_ _0"/>, since most of the trafc that we’ll want to </div><div class="t m0 x3 hd y1b01 ff4 fs7 fc0 sc0 ls0 ws0">manipulate is already cov<span class="_ _0"/>ered by our iptables mangling, HTTP server manipulation, </div><div class="t m0 x3 hd y1b02 ff4 fs7 fc0 sc0 ls0 ws0">and fake serv<span class="_ _0"/>ers, we won’<span class="_ _0"/>t cov<span class="_ _0"/>er ettercap or other tools here.</div><div class="t m0 x3 h7 y1b03 ff1 fs3 fc0 sc0 ls0 ws0">Fake Servers</div><div class="t m0 x3 hd y1b04 ff4 fs7 fc0 sc0 lsb ws16">There are a number of servers that we can run on our host to attempt to gather </div><div class="t m0 x3 hd y1b05 ff4 fs7 fc0 sc0 ls0 ws0">credentials in an easy way<span class="_ _2"/>. <span class="_ _0"/>When the user looks up the hostname for the intended </div><div class="t m0 x3 hd y1b06 ff4 fs7 fc0 sc0 ls0 ws0">system as usual, we’ll respond that the address is the address of our access point. </div><div class="t m0 x3 hd y1b07 ff4 fs7 fc0 sc0 ls0 ws0">The system will then assume it’<span class="_ _2"/>s talking to the intended host, and this typically </div><div class="t m0 x3 hd y1b08 ff4 fs7 fc0 sc0 ls0 ws0">means that the system will attempt to authenticate. Many common protocols still </div><div class="t m0 x3 hd y1b09 ff4 fs7 fc0 sc0 ls0 ws0">authenticate via cleartext or weak protocols. F<span class="_ _0"/>or example, if the client opens their </div><div class="t m0 x3 hd y1b0a ff4 fs7 fc0 sc0 ls0 ws0">e-mail program and looks up the host mail.weaktarget.com, we spoof the DNS </div><a class="" href="http://mail.weaktarget.com"><div class="d m1" style="border-style:none;position:absolute;left:296.417234px;bottom:90.751323px;width:95.000000px;height:13.000000px;background-color:rgba(255,255,255,0.000001);"/></a></div><div class="pi" data-data="{&#34;ctm&#34;:[1.209373,0.000000,0.000000,1.209373,0.000000,0.000000]}"/></div></div></body></html>