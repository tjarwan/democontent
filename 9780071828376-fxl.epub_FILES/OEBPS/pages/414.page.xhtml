<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml"><head><title/><link rel="stylesheet" href="../css/base.min.css"/><link rel="stylesheet" href="../css/fancy.min.css"/><link rel="stylesheet" href="../css/pdf.css"/><meta name="viewport" content="width=640, height=824"/></head><body><div id="page_body"><div id="pf19e" class="pf w2 h2" data-page-no="19e"><div class="pc pc19e w2 h2"><div class="t m0 x6 h10 y83 ff2 fs2 fc0 sc0 ls8 ws0">Chapter 10: APT Software Backdoors<span class="_ _9"> </span><span class="ff1 fs9 lsa">391</span></div><div class="t m0 x3 hd y11c ff4 fs7 fc0 sc0 ls0 ws0">system that has not been compromised, we can ensure the maximum amount of time </div><div class="t m0 x3 hd y11d ff4 fs7 fc0 sc0 ls0 ws0">for maintaining stealth access.</div><div class="t m0 x3 h4 y48c ff2 fs1 fc0 sc0 ls0 ws0">Network Stealth Congurations</div><div class="t m0 x3 hd y48d ff4 fs7 fc0 sc0 ls0 ws0">W<span class="_ _3"/>e’ll also want to craft our network communications in a way that mak<span class="_ _0"/>e </div><div class="t m0 x3 hd y48e ff4 fs7 fc0 sc0 ls0 ws0">them appear as innocuous as possible to anyone who might monitor netw<span class="_ _0"/>ork </div><div class="t m0 x3 hd y48f ff4 fs7 fc0 sc0 ls0 ws0">communication. There are man<span class="_ _0"/>y ways to do this.</div><div class="t m0 x4 hd ybfa ff4 fs7 fc0 sc0 ls0 ws0">Some of the specic elements we’ll want to account for include</div><div class="t m0 x16 h1f y249a ffb fse fc0 sc0 ls0 ws0">c</div><div class="t m0 x1 hd y249b ff4 fs7 fc0 sc0 ls0 ws0">Domain names resolved by our backdoor</div><div class="t m0 x16 h1f y24eb ffb fse fc0 sc0 ls0 ws0">c</div><div class="t m0 x1 hd y24ec ff4 fs7 fc0 sc0 ls0 ws0">Destination IP addresses and geoIP location of these IP addresses</div><div class="t m0 x16 h1f y24ed ffb fse fc0 sc0 ls0 ws0">c</div><div class="t m0 x1 hd y24ee ff4 fs7 fc0 sc0 ls0 ws0">Communications protocol and port</div><div class="t m0 x16 h1f y24ef ffb fse fc0 sc0 ls0 ws0">c</div><div class="t m0 x1 hd y24f0 ff4 fs7 fc0 sc0 ls0 ws0">Cleartext communications</div><div class="t m0 x16 h1f y24f1 ffb fse fc0 sc0 ls0 ws0">c</div><div class="t m0 x1 hd y24f2 ff4 fs7 fc0 sc0 ls0 ws0">Encrypted communications</div><div class="t m0 x16 h1f y24f3 ffb fse fc0 sc0 ls0 ws0">c</div><div class="t m0 x1 hd y24f4 ff4 fs7 fc0 sc0 ls0 ws0">Exltration of data ov<span class="_ _0"/>er this channel</div><div class="t m0 x4 hd y24f5 ff4 fs7 fc0 sc0 ls0 ws0">When designing the network communications, it’<span class="_ _2"/>s often best to do it under the </div><div class="t m0 x3 hd y24f6 ff4 fs7 fc0 sc0 ls0 ws0">assumption that all of the network communications will be observ<span class="_ _0"/>ed by a human </div><div class="t m0 x3 hd y24f7 ff4 fs7 fc0 sc0 ls0 ws0">with strong technical skills. By designing the backdoor to survi<span class="_ _0"/>ve the worst-case </div><div class="t m0 x3 hd y24f8 ff4 fs7 fc0 sc0 ls0 ws0">scenarios, we should hav<span class="_ _0"/>e no problem survi<span class="_ _0"/>ving the less sophisticated but f<span class="_ _0"/>ar more </div><div class="t m0 x3 hd y24f9 ff4 fs7 fc0 sc0 ls0 ws0">likely observ<span class="_ _0"/>ers.</div><div class="t m0 x4 hd y24fa ff4 fs7 fc0 sc0 ls0 ws0">The rst element to consider is the Domain Name System (DNS) names that our </div><div class="t m0 x3 hd y24fb ff4 fs7 fc0 sc0 ls0 ws0">backdoor will resolve to connect back to the C2 serv<span class="_ _0"/>er<span class="_ _2"/>. If we choose something that </div><div class="t m0 x3 hd y24fc ff4 fs7 fc0 sc0 ls0 ws0">looks random, this could be an obvious red ag. F<span class="_ _0"/>or example, some viruses will </div><div class="t m0 x3 hd y24fd ff4 fs7 fc0 sc0 ls0 ws0">automatically generate a random string of characters, such as adfyoilp.weaktarget</div><div class="t m0 x3 hd y24fe ff4 fs7 fc0 sc0 ls0 ws0">.com, which will then all resolve to the same host. Other times, an ob<span class="_ _0"/>viously random </div><div class="t m0 x3 hd y24ff ff4 fs7 fc0 sc0 ls0 ws0">or unintelligible domain will be chosen. In either case, these types of records appear </div><div class="t m0 x3 hd y2500 ff4 fs7 fc0 sc0 ls0 ws0">obviously out of place and can be easily identied at the netw<span class="_ _0"/>ork perimeter or at </div><div class="t m0 x3 hd y2501 ff4 fs7 fc0 sc0 lsc ws17">the organization’<span class="_ _2"/>s DNS servers.</div><div class="t m0 x4 hd y2502 ff4 fs7 fc0 sc0 ls0 ws0">Thus, we should choose and register a domain specic to the conte<span class="_ _0"/>xt of our </div><div class="t m0 x3 hd y2503 ff4 fs7 fc0 sc0 ls0 ws0">attack. Thinking back to our pre<span class="_ _0"/>vious e<span class="_ _0"/>xample, we registered a domain similar to a </div><div class="t m0 x3 hd y2504 ff4 fs7 fc0 sc0 ls0 ws0">specic software used by our tar<span class="_ _0"/>get employee (update.xf-software.com). Depending </div><div class="t m0 x3 hd y2505 ff4 fs7 fc0 sc0 ls0 ws0">on the context, you can choose a domain that is specic to the scenario or one that </div><div class="t m0 x3 hd y2506 ff4 fs7 fc0 sc0 ls0 ws0">is generic. For e<span class="_ _0"/>xample, you could choose to use a domain related to one of the </div><div class="t m0 x3 hd y2507 ff4 fs7 fc0 sc0 ls0 ws0">follo<span class="_ _0"/>wing:</div><div class="t m0 x16 h1f y2508 ffb fse fc0 sc0 ls0 ws0">c</div><div class="t m0 x1 hd y2509 ff4 fs7 fc0 sc0 ls0 ws0">T<span class="_ _0"/>ime synchronization</div><div class="t m0 x16 h1f y250a ffb fse fc0 sc0 ls0 ws0">c</div><div class="t m0 x1 hd y250b ff4 fs7 fc0 sc0 ls0 ws0">W<span class="_ _3"/>eather monitoring and update systems</div><a class="" href="http://adfyoilp.weaktarget.com"><div class="d m1" style="border-style:none;position:absolute;left:422.191988px;bottom:275.785336px;width:87.000000px;height:12.000000px;background-color:rgba(255,255,255,0.000001);"/></a><a class="" href="http://adfyoilp.weaktarget.com"><div class="d m1" style="border-style:none;position:absolute;left:94.452003px;bottom:258.854119px;width:25.000000px;height:13.000000px;background-color:rgba(255,255,255,0.000001);"/></a></div><div class="pi" data-data="{&#34;ctm&#34;:[1.209373,0.000000,0.000000,1.209373,0.000000,0.000000]}"/></div></div></body></html>