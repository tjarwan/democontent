<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml"><head><title/><link rel="stylesheet" href="../css/base.min.css"/><link rel="stylesheet" href="../css/fancy.min.css"/><link rel="stylesheet" href="../css/pdf.css"/><meta name="viewport" content="width=640, height=824"/></head><body><div id="page_body"><div id="pf19c" class="pf w2 h2" data-page-no="19c"><div class="pc pc19c w2 h2"><div class="t m0 x6 h10 y83 ff2 fs2 fc0 sc0 ls8 ws0">Chapter 10: APT Software Backdoors<span class="_ _9"> </span><span class="ff1 fs9 lsa">389</span></div><div class="t m0 x4 hd y11c ff4 fs7 fc0 sc0 ls0 ws0">This technique is actually very simple—note that the e<span class="_ _0"/>xecutable names are </div><div class="t m0 x3 hd y11d ff4 fs7 fc0 sc0 ls0 ws0">obviously not what we w<span class="_ _0"/>ould use in the real world, b<span class="_ _0"/>ut are used here for the sake </div><div class="t m0 x3 hd y11e ff4 fs7 fc0 sc0 ls0 ws0">of clarity<span class="_ _2"/>. The dropper<span class="_ _2"/>, which is deployed from a phishing website, connects back </div><div class="t m0 x3 hd y15c ff4 fs7 fc0 sc0 ls0 ws0">to our command-and-control server and requests an HTML page with a GET </div><div class="t m0 x3 hd y15d ff4 fs7 fc0 sc0 ls0 ws0">request. The GET request includes the username and machine name that is running </div><div class="t m0 x3 hd y271 ff4 fs7 fc0 sc0 ls0 ws0">the dropper<span class="_ _2"/>. W<span class="_ _2"/>ithin the requested page are the URLs of les that the dropper will </div><div class="t m0 x3 hd y272 ff4 fs7 fc0 sc0 lsb ws16">do<span class="_ _0"/>wnload and “install.<span class="_ _2"/>” In this case, the in<span class="_ _0"/>vestigator sees that the dropper do<span class="_ _0"/>wnloads </div><div class="t m0 x3 hd y201c ff4 fs7 fc0 sc0 ls0 ws0">backdoor<span class="_ _2"/>.exe and ke<span class="_ _0"/>ylog.dll and places them in the C\W<span class="_ _0"/>indo<span class="_ _0"/>ws\T<span class="_ _3"/>emp directory<span class="_ _0"/>. <span class="_ _2"/>A </div><div class="t m0 x3 hd y218f ff4 fs7 fc0 sc0 ls0 ws0">single registry entry is then created to autostart the backdoor<span class="_ _2"/>.ex<span class="_ _0"/>e program. This looks </div><div class="t m0 x3 hd y2190 ff4 fs7 fc0 sc0 ls0 ws0">something like this:</div><div class="t m0 x65 hd y24b9 ff4 fs7 fc0 sc0 ls0 ws0">Dropper<span class="_ _2"/>.exe <span class="ff13">→</span> HTTP GET <span class="ff13">→</span> Do<span class="_ _0"/>wnload 2 Files <span class="ff13">→</span> Mov<span class="_ _0"/>e to C\W<span class="_ _0"/>indo<span class="_ _0"/>ws\</div><div class="t m0 x65 hd y24ba ff4 fs7 fc0 sc0 ls0 ws0">T<span class="_ _2"/>emp <span class="ff13">→</span> Run</div><div class="t m0 x4 hd y24bb ff4 fs7 fc0 sc0 ls0 ws0">The backdoor<span class="_ _2"/>.exe program then periodically polls the command-and-control </div><div class="t m0 x3 hd y24bc ff4 fs7 fc0 sc0 ls0 ws0">server and will post k<span class="_ _0"/>eylog data e<span class="_ _0"/>very hour<span class="_ _2"/>. It’<span class="_ _2"/>s important to understand that in </div><div class="t m0 x3 hd y24bd ff4 fs7 fc0 sc0 lsb ws16">this example we’<span class="_ _0"/>ll assume the in<span class="_ _0"/>vestigator is able to see e<span class="_ _0"/>v<span class="_ _0"/>erything the dropper </div><div class="t m0 x3 hd y24be ff4 fs7 fc0 sc0 ls0 ws0">and backdoor programs do, including all le accesses, registry writes, and netw<span class="_ _0"/>ork </div><div class="t m0 x3 hd y24bf ff4 fs7 fc0 sc0 ls0 ws0">trafc. There are se<span class="_ _0"/>v<span class="_ _0"/>eral dynamic analysis tools that make obtaining this type of </div><div class="t m0 x3 hd y24c0 ff4 fs7 fc0 sc0 lsb ws16">information easy for an in<span class="_ _0"/>v<span class="_ _0"/>estigator<span class="_ _0"/>.</div><div class="t m0 x4 hd y24c1 ff4 fs7 fc0 sc0 lsb ws16">When the in<span class="_ _0"/>v<span class="_ _0"/>estigator looks at all of the infected client machines, it mirrors </div><div class="t m0 x3 hd y24c2 ff4 fs7 fc0 sc0 ls0 ws0">exactly what the<span class="_ _0"/>y just saw: backdoor<span class="_ _2"/>.ex<span class="_ _0"/>e and keylog.dll are in the C/W<span class="_ _2"/>indows/T<span class="_ _3"/>emp </div><div class="t m0 x3 hd y24c3 ff4 fs7 fc0 sc0 lsb ws16">directory<span class="_ _2"/>, and the same autostart registry entry is in place. <span class="_ _0"/>The in<span class="_ _0"/>vestigator kills the </div><div class="t m0 x3 hd y24c4 ff4 fs7 fc0 sc0 ls0 ws0">backdoor<span class="_ _2"/>.exe process on the infected machine, deletes the les, deletes the re<span class="_ _0"/>gistry </div><div class="t m0 x3 hd y24c5 ff4 fs7 fc0 sc0 ls0 ws0">entry<span class="_ _2"/>, and calls it a day<span class="_ _2"/>.</div><div class="t m0 x4 hd y24c6 ff4 fs7 fc0 sc0 ls0 ws0">No<span class="_ _0"/>w let’<span class="_ _0"/>s understand what the administrator did not see. <span class="_ _0"/>The trick here is that </div><div class="t m0 x3 hd y24c7 ff4 fs7 fc0 sc0 ls0 ws0">on the end-user systems after the dropper do<span class="_ _0"/>wnloaded and deployed backdoor<span class="_ _2"/>.exe, </div><div class="t m0 x3 hd y24c8 ff4 fs7 fc0 sc0 ls0 ws0">the dropper then do<span class="_ _0"/>wnloaded and installed a second backdoor—the true backdoor; </div><div class="t m0 x3 hd y24c9 ff4 fs7 fc0 sc0 ls0 ws0">we’ll call it rootkit.e<span class="_ _0"/>xe. <span class="_ _0"/>The rootkit.ex<span class="_ _0"/>e le is mov<span class="_ _0"/>ed to a directory different from </div><div class="t m0 x3 hd y24ca ff4 fs7 fc0 sc0 ls0 ws0">C:\W<span class="_ _0"/>indo<span class="_ _0"/>ws\T<span class="_ _2"/>emp and ex<span class="_ _0"/>ecutes DLLs to hide itself and any related les, re<span class="_ _0"/>gistry </div><div class="t m0 x3 hd y24cb ff4 fs7 fc0 sc0 ls0 ws0">entries, or process information. The rootkit.e<span class="_ _0"/>xe program then sits and w<span class="_ _0"/>aits silently </div><div class="t m0 x3 hd y24cc ff4 fs7 fc0 sc0 ls0 ws0">for a week to pass, at which point it will start performing our intended actions and </div><div class="t m0 x3 hd y24cd ff4 fs7 fc0 sc0 ls0 ws0">communicating with a scommand-and-control server that is dif<span class="_ _0"/>ferent from the </div><div class="t m0 x3 hd y24ce ff4 fs7 fc0 sc0 ls0 ws0">system that backdoor<span class="_ _2"/>.exe communicated with.</div><div class="t m0 x65 hd y24cf ff4 fs7 fc0 sc0 ls0 ws0">Dropper<span class="_ _2"/>.exe <span class="ff13">→</span> HTTP GET <span class="ff13">→</span> Do<span class="_ _0"/>wnload 2 Files <span class="ff13">→</span> Mov<span class="_ _0"/>e to C\W<span class="_ _0"/>indo<span class="_ _0"/>ws\</div><div class="t m0 x65 hd y24d0 ff4 fs7 fc0 sc0 ls0 ws0">T<span class="_ _2"/>emp <span class="ff13">→</span> Run</div><div class="t m0 x65 hd y24d1 ff4 fs7 fc0 sc0 ls0 ws0">Dropper<span class="_ _2"/>.exe <span class="_ _3"/><span class="ff13">→<span class="ff4 ws36"> HTTP GET <span class="ff13">→</span> Download 4 Files <span class="ff13">→</span> Mo<span class="_ _0"/>ve to C\W<span class="_ _2"/>indows\RK <span class="ff13">→</span></span></span></div><div class="t m0 x65 hd y24d2 ff4 fs7 fc0 sc0 ls0 ws0">Run rootkit to hide real processes, les, registry entries <span class="ff13">→</span> Sleep for a week</div></div><div class="pi" data-data="{&#34;ctm&#34;:[1.209373,0.000000,0.000000,1.209373,0.000000,0.000000]}"/></div></div></body></html>