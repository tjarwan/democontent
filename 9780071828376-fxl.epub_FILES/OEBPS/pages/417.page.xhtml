<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml"><head><title/><link rel="stylesheet" href="../css/base.min.css"/><link rel="stylesheet" href="../css/fancy.min.css"/><link rel="stylesheet" href="../css/pdf.css"/><meta name="viewport" content="width=640, height=824"/></head><body><div id="page_body"><div id="pf1a1" class="pf w2 h2" data-page-no="1a1"><div class="pc pc1a1 w2 h2"><div class="t m0 xbe h10 y83 ff1 fs9 fc0 sc0 lsa ws0">394<span class="_ _d"> </span><span class="ff2 fs2 ls8">Advanced Persistent Threat Hacking<span class="_ _1e"/> </span></div><div class="t m0 x3 hd y11c ff4 fs7 fc0 sc0 ls0 ws0">unlikely to encounter them in the wild.  Man<span class="_ _0"/>y of the same techniques will actually </div><div class="t m0 x3 hd y11d ff4 fs7 fc0 sc0 ls0 ws0">work for other operating systems, and much of the source code can be reused for </div><div class="t m0 x3 hd y20f ff4 fs7 fc0 sc0 ls0 ws0">other operating systems. Ho<span class="_ _0"/>wev<span class="_ _0"/>er<span class="_ _0"/>, with limited space in this book, we will focus on </div><div class="t m0 x3 hd y210 ff4 fs7 fc0 sc0 ls0 ws0">the most pre<span class="_ _0"/>valent operating system.</div><div class="t m0 x4 hd y120 ff4 fs7 fc0 sc0 ls0 ws0">The majority of our examples will utilize the C programming language; in some </div><div class="t m0 x3 hd y121 ff4 fs7 fc0 sc0 ls0 ws0">cases, a little C++ will be used. Most of our de<span class="_ _0"/>velopment will be performed using </div><div class="t m0 x3 hd y398 ff4 fs7 fc0 sc0 ls0 ws0">the bloodshed De<span class="_ _0"/>v-C++ integrated de<span class="_ _0"/>velopment en<span class="_ _2"/>vironment (IDE) and compiled </div><div class="t m0 x3 hd y399 ff4 fs7 fc0 sc0 ls0 ws0">with the included mingw port of the GNU Compiler Collection (GCC) compiler<span class="_ _2"/>. </div><div class="t m0 x3 hd y3c6 ff4 fs7 fc0 sc0 ls0 ws0">Some examples may require Microsoft <span class="_ _2"/>V<span class="_ _2"/>isual Studio, software dev<span class="_ _0"/>elopment kits, or </div><div class="t m0 x3 hd y4b0 ff4 fs7 fc0 sc0 ls0 ws0">dri<span class="_ _0"/>ver de<span class="_ _0"/>velopment kits; you should ha<span class="_ _0"/>ve a passing understanding of these systems, </div><div class="t m0 x3 hd y4b1 ff4 fs7 fc0 sc0 ls0 ws0">most of which are free to do<span class="_ _0"/>wnload.</div><div class="t m0 x4 hd y39a ff4 fs7 fc0 sc0 ls0 ws0">W<span class="_ _3"/>e won’t cov<span class="_ _0"/>er binary obfuscation techniques such as packing ex<span class="_ _0"/>ecutables. </div><div class="t m0 x3 hd y39b ff4 fs7 fc0 sc0 ls0 ws0">Pack<span class="_ _0"/>ers, such as the popular UPX program, will essentially compress a binary for </div><div class="t m0 x3 hd y4b2 ff4 fs7 fc0 sc0 ls0 ws0">two primary reasons: to condense the le size of the binary and to obscure the true </div><div class="t m0 x3 hd y4b3 ff4 fs7 fc0 sc0 ls0 ws0">functionality from static analysis. In many cases, binaries that are pack<span class="_ _0"/>ed with well-</div><div class="t m0 x3 hd y4b4 ff4 fs7 fc0 sc0 ls0 ws0">kno<span class="_ _0"/>wn packers will be detected as being suspicious or potentially malicious.</div><div class="t m0 x3 h4 y2534 ff2 fs1 fc0 sc0 ls0 ws0">Backdoor Droppers</div><div class="t m0 x3 hd y2535 ff4 fs7 fc0 sc0 ls0 ws0">The dropper’<span class="_ _2"/>s basic functionality is to be the central executable for deploying our </div><div class="t m0 x3 hd y2536 ff4 fs7 fc0 sc0 ls0 ws0">backdoor<span class="_ _2"/>. One of the main benets of using a dropper is that it can be much smaller </div><div class="t m0 x3 hd y2537 ff4 fs7 fc0 sc0 ls0 ws0">than our backdoor and supporting les, and will thus be much faster to do<span class="_ _0"/>wnload or </div><div class="t m0 x3 hd y2538 ff4 fs7 fc0 sc0 ls0 ws0">transfer to a compromised system, as well as loading and ex<span class="_ _0"/>ecuting faster<span class="_ _2"/>.</div><div class="t m0 x4 hd y22e9 ff4 fs7 fc0 sc0 ls0 ws0">Beyond simply do<span class="_ _0"/>wnloading the backdoor les, the dropper can also install the </div><div class="t m0 x3 hd y2539 ff4 fs7 fc0 sc0 ls0 ws0">les where necessary and congure any autostart settings. But at its most simple </div><div class="t m0 x3 hd y253a ff4 fs7 fc0 sc0 ls0 ws0">form, a dropper can literally just check a fe<span class="_ _0"/>w locations for write privile<span class="_ _0"/>ges, do<span class="_ _0"/>wnload </div><div class="t m0 x3 hd y253b ff4 fs7 fc0 sc0 ls0 ws0">another ex<span class="_ _0"/>ecutable to that location, run the ex<span class="_ _0"/>ecutable, and then exit. <span class="_ _0"/>The dropper </div><div class="t m0 x3 hd y253c ff4 fs7 fc0 sc0 ls0 ws0">can be congured to statically request a specic le or try multiple hard-coded les.</div><div class="t m0 x4 hd y253d ff4 fs7 fc0 sc0 ls0 ws0">W<span class="_ _3"/>e can also get very creativ<span class="_ _0"/>e with the protocol we choose to utilize to do<span class="_ _0"/>wnload </div><div class="t m0 x3 hd y253e ff4 fs7 fc0 sc0 ls0 ws0">any les. Some possibilities include HTTP<span class="_ _1b"/>, HTTPS, SSH, and e<span class="_ _0"/>ven DNS.</div><div class="t m0 x4 hd y253f ff4 fs7 fc0 sc0 ls0 ws0">Our rst dropper example will utilize the cURL library<span class="_ _3"/>. From the cURL website:</div><div class="t m0 x65 hd y2540 ff4 fs7 fc0 sc0 ls0 ws0">“cURL is a command-line tool for transferring data with URL syntax, </div><div class="t m0 x65 hd y2541 ff4 fs7 fc0 sc0 ls0 ws0">supporting DICT<span class="_ _2"/>, FILE, FTP<span class="_ _1b"/>, FTPS, Gopher<span class="_ _0"/>, HTTP<span class="_ _1b"/>, HTTPS, IMAP<span class="_ _3"/>, IMAPS, </div><div class="t m0 x65 hd y2542 ff4 fs7 fc0 sc0 ls0 ws0">LD<span class="_ _0"/>AP<span class="_ _1b"/>, LD<span class="_ _0"/>APS, POP3, POP3S, R<span class="_ _2"/>TMP<span class="_ _3"/>, R<span class="_ _2"/>TSP<span class="_ _3"/>, SCP<span class="_ _1b"/>, SFTP<span class="_ _3"/>, SMTP<span class="_ _3"/>, SMTPS, </div><div class="t m0 x65 hd y2543 ff4 fs7 fc0 sc0 ls0 ws0">T<span class="_ _2"/>elnet, and TFTP<span class="_ _1b"/>. cURL supports SSL certicates, HTTP POST<span class="_ _2"/>, HTTP PUT<span class="_ _2"/>, </div><div class="t m0 x65 hd y2544 ff4 fs7 fc0 sc0 ls0 ws0">FTP uploading, HTTP form-based upload, proxies, cookies, user + password </div><div class="t m0 x65 hd y2545 ff4 fs7 fc0 sc0 ls0 ws0">authentication (basic, digest, NTLM, negotiate, K<span class="_ _0"/>erberos…), le transfer </div><div class="t m0 x65 hd y2546 ff4 fs7 fc0 sc0 ls0 ws0">resume, proxy tunneling, and a busload of other useful tricks.<span class="_ _3"/>”</div></div><div class="pi" data-data="{&#34;ctm&#34;:[1.209373,0.000000,0.000000,1.209373,0.000000,0.000000]}"/></div></div></body></html>