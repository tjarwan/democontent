<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml"><head><title/><link rel="stylesheet" href="../css/base.min.css"/><link rel="stylesheet" href="../css/fancy.min.css"/><link rel="stylesheet" href="../css/pdf.css"/><meta name="viewport" content="width=640, height=824"/></head><body><div id="page_body"><div id="pf1b6" class="pf w2 h2" data-page-no="1b6"><div class="pc pc1b6 w2 h2"><img class="bi xa5 y2774 wf h84" alt="" src="bg1b6.png"/><div class="t m0 x6 h10 y83 ff2 fs2 fc0 sc0 ls8 ws0">Chapter 10: APT Software Backdoors<span class="_ _9"> </span><span class="ff1 fs9 lsa">415</span></div><div class="t m0 x3 hd y11c ff4 fs7 fc0 sc0 ls0 ws0">administrator credentials; ho<span class="_ _0"/>wev<span class="_ _0"/>er<span class="_ _0"/>, there are man<span class="_ _0"/>y scenarios where this would </div><div class="t m0 x3 hd y11d ff4 fs7 fc0 sc0 ls0 ws0">still be v<span class="_ _0"/>aluable. For e<span class="_ _0"/>xample, you may hav<span class="_ _0"/>e local administrator privile<span class="_ _0"/>ges from </div><div class="t m0 x3 hd y20f ff4 fs7 fc0 sc0 ls0 ws0">the user who is ex<span class="_ _0"/>ecuting your backdoor; ho<span class="_ _0"/>wev<span class="_ _0"/>er<span class="_ _0"/>, you still want domain admin </div><div class="t m0 x3 hd y210 ff4 fs7 fc0 sc0 ls0 ws0">pri<span class="_ _0"/>vileges, which may be possible to obtain if an administrator were to log into the </div><div class="t m0 x3 hd y211 ff4 fs7 fc0 sc0 ls0 ws0">compromised computer<span class="_ _2"/>.</div><div class="t m0 x4 hd y212 ff4 fs7 fc0 sc0 ls0 ws0">Microsoft <span class="_ _0"/>W<span class="_ _0"/>indo<span class="_ _0"/>ws 2000, XP<span class="_ _1b"/>, and Server 2003 use the GIN<span class="_ _0"/>A system to allo<span class="_ _0"/>w </div><div class="t m0 x3 hd y398 ff4 fs7 fc0 sc0 ls0 ws0">users to authenticate to the local system. <span class="_ _0"/>When you recei<span class="_ _0"/>ve the -<span class="_ _0"/><span class="_ _0"/>-</div><div class="t m0 x3 hd y399 ff4 fs7 fc0 sc0 ls0 ws0">prompt in <span class="_ _0"/>W<span class="_ _0"/>indo<span class="_ _0"/>ws XP<span class="_ _1b"/>, you’<span class="_ _0"/>re interacting with the GIN<span class="_ _0"/>A. Backdooring this system </div><div class="t m0 x3 hd y3c6 ff4 fs7 fc0 sc0 ls0 ws0">is a relati<span class="_ _0"/>vely straightforward task. <span class="_ _0"/>W<span class="_ _3"/>e can either replace the GIN<span class="_ _0"/>A entirely and </div><div class="t m0 x3 hd y4b0 ff4 fs7 fc0 sc0 ls0 ws0">write our o<span class="_ _0"/>wn to look exactly like the def<span class="_ _0"/>ault, or we can simply extend the e<span class="_ _0"/>xisting </div><div class="t m0 x3 hd y4b1 ff4 fs7 fc0 sc0 ls0 ws0">system using a GIN<span class="_ _0"/>A stub<span class="_ _0"/>.</div><div class="t m0 x4 hd y39a ff4 fs7 fc0 sc0 ls0 ws0">This operation works similarly to a <span class="_ _0"/>W<span class="_ _0"/>indo<span class="_ _0"/>ws hook. <span class="_ _0"/>W<span class="_ _3"/>e basically hav<span class="_ _0"/>e access to </div><div class="t m0 x3 hd y39b ff4 fs7 fc0 sc0 ls0 ws0">e<span class="_ _0"/>verything that the normal GIN<span class="_ _0"/>A has access to, and we can choose to manipulate the </div><div class="t m0 x3 hd y4b2 ff4 fs7 fc0 sc0 ls0 ws0">data ho<span class="_ _0"/>wev<span class="_ _0"/>er we choose. <span class="_ _2"/>An example GIN<span class="_ _0"/>A stub can be do<span class="_ _0"/>wnloaded from the <span class="_ _2"/>APT </div><div class="t m0 x3 hd y4b3 ff4 fs7 fc0 sc0 ls0 ws0">Hacking website.</div><div class="t m0 x4 hd y39e ff4 fs7 fc0 sc0 ls0 ws0">In this case, the GIN<span class="_ _0"/>A stub DLL logs all usernames, passwords, and domains to </div><div class="t m0 x3 hd y39f ff4 fs7 fc0 sc0 ls0 ws0">the text le c:\windo<span class="_ _0"/>ws\sys.dll. <span class="_ _0"/>T<span class="_ _2"/>o install the GIN<span class="_ _0"/>A stub DLL, we need to create an </div><div class="t m0 x3 hd y3a0 ff4 fs7 fc0 sc0 ls0 ws0">entry in the registry at HKLM\SOFTW<span class="_ _1b"/>ARE\Microsoft\W<span class="_ _0"/>indo<span class="_ _0"/>ws NT\CurrentV<span class="_ _1b"/>ersion\</div><div class="t m0 x3 hd y3a1 ff4 fs7 fc0 sc0 ls0 ws0">W<span class="_ _0"/>inlogon\GinaDLL, which needs to be a REG_SZ v<span class="_ _0"/>alue pointing to the gs.dll le </div><div class="t m0 x3 hd y3a2 ff4 fs7 fc0 sc0 ls0 ws0">in the system32 directory<span class="_ _2"/>. <span class="_ _0"/>After the credentials are logged, it’<span class="_ _2"/>s simply a matter of </div><div class="t m0 x3 hd y57b ff4 fs7 fc0 sc0 ls0 ws0">uploading the text le to our C2 serv<span class="_ _0"/>er<span class="_ _2"/>.</div><div class="t m0 x4 hd y2775 ff4 fs7 fc0 sc0 ls0 ws0">In <span class="_ _0"/>W<span class="_ _0"/>indo<span class="_ _0"/>ws <span class="_ _2"/>V<span class="_ _0"/>ista and later<span class="_ _0"/>, Microsoft changed the authentication system to </div><div class="t m0 x3 hd y2776 ff4 fs7 fc0 sc0 ls0 ws0">use credential providers; thus, the GIN<span class="_ _2"/>A system no longer works. It’<span class="_ _0"/>s important </div><div class="t m0 x3 hd y2777 ff4 fs7 fc0 sc0 ls0 ws0">to understand, ho<span class="_ _0"/>wev<span class="_ _0"/>er<span class="_ _0"/>, that the credential pro<span class="_ _0"/>vider does not actually perform the </div><div class="t m0 x3 hd y2778 ff4 fs7 fc0 sc0 lsb ws16">authentication—it simply gathers the credentials to pass of<span class="_ _0"/>f to the authentication </div><div class="t m0 x3 hd y2779 ff4 fs7 fc0 sc0 ls0 ws0">system. Credential providers can actually coe<span class="_ _0"/>xist as separate tiles, allo<span class="_ _0"/>wing the user </div><div class="t m0 x3 hd y277a ff4 fs7 fc0 sc0 ls0 ws0">to choose ho<span class="_ _0"/>w they would lik<span class="_ _0"/>e to authenticate. For e<span class="_ _0"/>xample, you could allow users to </div><div class="t m0 x3 hd y277b ff4 fs7 fc0 sc0 ls0 ws0">authenticate with a traditional username and password with one tile or authenticate </div><div class="t m0 x3 hd y277c ff4 fs7 fc0 sc0 ls0 ws0">with only a smart card in another tile.</div></div><div class="pi" data-data="{&#34;ctm&#34;:[1.209373,0.000000,0.000000,1.209373,0.000000,0.000000]}"/></div></div></body></html>