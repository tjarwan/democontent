<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml"><head><title/><link rel="stylesheet" href="../css/base.min.css"/><link rel="stylesheet" href="../css/fancy.min.css"/><link rel="stylesheet" href="../css/pdf.css"/><meta name="viewport" content="width=640, height=824"/></head><body><div id="page_body"><div id="pf1b7" class="pf w2 h2" data-page-no="1b7"><div class="pc pc1b7 w2 h2"><img class="bi x20 y277d w10 h9d" alt="" src="bg1b7.png"/><div class="t m0 xbe h10 y83 ff1 fs9 fc0 sc0 lsa ws0">416<span class="_ _d"> </span><span class="ff2 fs2 ls8">Advanced Persistent Threat Hacking<span class="_ _1e"/> </span></div><div class="t m0 x4 hd y11c ff4 fs7 fc0 sc0 ls0 ws0">W<span class="_ _0"/>indo<span class="_ _0"/>ws comes with a default credential pro<span class="_ _0"/>vider called Password Credential </div><div class="t m0 x3 hd y11d ff4 fs7 fc0 sc0 lsb ws16">Provider<span class="_ _2"/>. <span class="_ _2"/>Again, rather than having to write an entire credential provider from </div><div class="t m0 x3 hd y11e ff4 fs7 fc0 sc0 ls0 ws0">scratch, we can choose to expand on the functionality of the def<span class="_ _0"/>ault credential </div><div class="t m0 x3 hd y15c ff4 fs7 fc0 sc0 ls0 ws0">provider<span class="_ _2"/>. T<span class="_ _3"/>o do this, we use a technique called a wrapped credential provider<span class="_ _0"/>, which </div><div class="t m0 x3 hd y15d ff4 fs7 fc0 sc0 ls0 ws0">operates just like it sounds. <span class="_ _0"/>W<span class="_ _3"/>e also hav<span class="_ _0"/>e to hide the existing credential providers, </div><div class="t m0 x3 hd y271 ff4 fs7 fc0 sc0 ls0 ws0">to force the user to use our backdoored credential provider<span class="_ _2"/>, which can be done </div><div class="t m0 x3 hd y272 ff4 fs7 fc0 sc0 ls0 ws0">programmatically using a credential provider lter<span class="_ _2"/>.</div><div class="t m0 x4 hd y160 ff4 fs7 fc0 sc0 ls0 ws0">Both of these techniques are av<span class="_ _0"/>ailable from the <span class="_ _2"/>APT Hacking website. The DLL </div><div class="t m0 x3 hd y161 ff4 fs7 fc0 sc0 lsb ws16">logs credentials to c:\cplog.txt, which again can be sent back to our C2 server in an<span class="_ _0"/>y </div><div class="t m0 x3 hd y273 ff4 fs7 fc0 sc0 ls0 ws0">way we choose.</div><div class="t m0 x3 h7 y277e ff1 fs3 fc0 sc0 ls0 ws0">Data Exﬁltration</div><div class="t m0 x3 hd y277f ff4 fs7 fc0 sc0 ls0 ws0">Exltrating data ov<span class="_ _0"/>er an encrypted HTTP tunnel is an easy task with the cURL </div><div class="t m0 x3 hd y2780 ff4 fs7 fc0 sc0 ls0 ws0">library<span class="_ _2"/>. The data you need to e<span class="_ _0"/>xltrate may<span class="_ _2"/>, among other things, be the keystrokes </div><div class="t m0 x3 hd y2781 ff4 fs7 fc0 sc0 ls0 ws0">you’<span class="_ _2"/>ve logged, the les you’<span class="_ _0"/>v<span class="_ _0"/>e identied that may hav<span class="_ _0"/>e interesting data, or the </div><div class="t m0 x3 hd y2782 ff4 fs7 fc0 sc0 ls0 ws0">credentials you’<span class="_ _2"/>ve collected. In addition, you can use methods from other binaries </div><div class="t m0 x3 hd y2783 ff4 fs7 fc0 sc0 ls0 ws0">such as netcat or the FTP command to send les.</div><div class="t m0 x4 hd y2784 ff4 fs7 fc0 sc0 ls0 ws0">Rather than relying only on le transfer methods, we can also choose to get the </div><div class="t m0 x3 hd y2785 ff4 fs7 fc0 sc0 ls0 ws0">data back to our servers in nontraditional w<span class="_ _0"/>ays. For e<span class="_ _0"/>xample, if the data we wish to </div><div class="t m0 x3 hd y2786 ff4 fs7 fc0 sc0 ls0 ws0">exltrate is hashes of passw<span class="_ _0"/>ords or cleartext passwords, we may ha<span class="_ _0"/>v<span class="_ _0"/>e ev<span class="_ _0"/>en subtler </div><div class="t m0 x3 hd y2787 ff4 fs7 fc0 sc0 lsb ws16">methods to exltrate data that are harder for an in<span class="_ _2"/>vestigator to detect. The DNS </div><div class="t m0 x3 hd y2788 ff4 fs7 fc0 sc0 ls0 ws0">system is one possible solution to exltrate data. <span class="_ _0"/>W<span class="_ _3"/>e can hav<span class="_ _0"/>e the backdoored system </div><div class="t m0 x3 hd y2789 ff4 fs7 fc0 sc0 ls0 ws0">attempt to resolve a host for a domain that we control, which includes the passw<span class="_ _0"/>ord </div><div class="t m0 x3 hd y278a ff4 fs7 fc0 sc0 ls0 ws0">or hash.</div><div class="t m0 x4 hd y278b ff4 fs7 fc0 sc0 ls0 ws0">The DNS protocol limits any specic label to 63 characters, and the total record </div><div class="t m0 x3 hd y278c ff4 fs7 fc0 sc0 ls0 ws0">can be no more than 253 characters. These limitations are ne for what we’<span class="_ _2"/>re </div><div class="t m0 x3 hd y278d ff4 fs7 fc0 sc0 ls0 ws0">concerned with here. <span class="_ _2"/>As an example, the LM hash is only 32 characters long, and if </div></div><div class="pi" data-data="{&#34;ctm&#34;:[1.209373,0.000000,0.000000,1.209373,0.000000,0.000000]}"/></div></div></body></html>