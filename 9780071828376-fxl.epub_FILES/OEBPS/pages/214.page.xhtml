<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml"><head><title/><link rel="stylesheet" href="../css/base.min.css"/><link rel="stylesheet" href="../css/fancy.min.css"/><link rel="stylesheet" href="../css/pdf.css"/><meta name="viewport" content="width=640, height=824"/></head><body><div id="page_body"><div id="pfd6" class="pf w2 h2" data-page-no="d6"><div class="pc pcd6 w2 h2"><img class="bi xaf y144a w4 h61" alt="" src="bgd6.png"/><div class="t m0 x6 h10 y83 ff2 fs2 fc0 sc0 ls8 ws0">Chapter 6: Spear Social Engineering<span class="_ _9"> </span><span class="ff1 fs9 lsa">191</span></div><div class="t m0 x4 hd y144b ff4 fs7 fc0 sc0 ls0 ws0">T<span class="_ _3"/>o perform this attack, we’ll use the PHP-phoxy tool, which stands for PHP-</div><div class="t m0 x3 hd y144c ff4 fs7 fc0 sc0 ls0 ws0">PhishingprO<span class="_ _0"/>XY<span class="_ _1b"/>. PHP-phoxy is an adaptation of the php-proxy (https://code.google</div><div class="t m0 x3 hd y144d ff4 fs7 fc0 sc0 ls0 ws0">.com/p/php-proxy/) written by Rob Thomson. <span class="_ _0"/>This tool handles POST<span class="_ _3"/>, cookie, and </div><div class="t m0 x3 hd y144e ff4 fs7 fc0 sc0 ls0 ws0">session v<span class="_ _0"/>ariables seamlessly<span class="_ _2"/>. T<span class="_ _3"/>o set up PHP-phoxy<span class="_ _0"/>, you’<span class="_ _0"/>ll start by editing the <span class="_ _2"/>Apache </div><div class="t m0 x3 hd y144f ff4 fs7 fc0 sc0 ls0 ws0">conguration le in Kali, to enable the use of .htaccess les. Edit the le </div><div class="t m0 x3 hd y1450 ff4 fs7 fc0 sc0 ls0 ws0">/etc/apache2/sites-enabled/000-default and change the line (or lines) that say</div><div class="t m0 x3 h44 y1451 fff fse fc0 sc0 ls0 ws0">AllowOverride None</div><div class="t m0 x3 hd y1452 ff4 fs7 fc0 sc0 ls0 ws0">to</div><div class="t m0 x3 h44 y1453 fff fse fc0 sc0 ls0 ws0">AllowOverride All</div><div class="t m0 x4 hd y1454 ff4 fs7 fc0 sc0 ls0 ws0">Then enable the re<span class="_ _0"/>write module with the command </div><div class="t m0 x3 h44 y1455 fff fse fc0 sc0 ls0 ws0">root@kali:~# a2enmod rewrite</div><div class="t m0 x4 hd y1456 ff4 fs7 fc0 sc0 ls0 ws0">Then do<span class="_ _0"/>wnload the PHP-phoxy tool and extract the two les to the web directory </div><div class="t m0 x3 hd y1457 ff4 fs7 fc0 sc0 ls0 ws0">(/v<span class="_ _0"/>ar/www/). Rename the included le htaccess.txt to .htaccess. The htaccess le is </div><div class="t m0 x3 hd y1458 ff4 fs7 fc0 sc0 ls0 ws0">what handles the re<span class="_ _0"/>writing of URLs so that no matter what URL the user requests, it </div><div class="t m0 x3 hd y1459 ff4 fs7 fc0 sc0 ls0 ws0">is handled by the index.php le. <span class="_ _1b"/>Y<span class="_ _3"/>ou’ll also hav<span class="_ _0"/>e to create the phoxy-out.txt le and </div><div class="t m0 x3 hd y145a ff4 fs7 fc0 sc0 ls0 ws0">allo<span class="_ _0"/>w the <span class="_ _0"/>Apache user to write to the le with the follo<span class="_ _0"/>wing commands:</div><div class="t m0 x3 h44 y145b fff fse fc0 sc0 ls0 ws0">root@kali:/var/www#  touch phoxy-out.txt</div><div class="t m0 x3 h44 y145c fff fse fc0 sc0 ls0 ws0">root@kali:/var/www#  chmod 777 phoxy-out.txt</div><div class="t m0 x4 hd y145d ff4 fs7 fc0 sc0 ls0 ws0">All of the resources requested by the user<span class="_ _0"/>, as well as all of the POST data from the </div><div class="t m0 x3 hd y145e ff4 fs7 fc0 sc0 ls0 ws0">user<span class="_ _0"/>, is recorded in the phoxy-out.txt le. <span class="_ _0"/>T<span class="_ _2"/>o start using the proxy<span class="_ _2"/>, you simply hav<span class="_ _0"/>e </div><div class="t m0 x3 hd y145f ff4 fs7 fc0 sc0 ls0 ws0">to adjust the $base v<span class="_ _0"/>ariable to point to the target website. Once the proxy is all set, </div><div class="t m0 x3 hd y1460 ff4 fs7 fc0 sc0 ls0 ws0">you simply hav<span class="_ _0"/>e to direct the user to your phishing website and watch the log le for </div><div class="t m0 x3 hd y1461 ff4 fs7 fc0 sc0 ls0 ws0">the good stuf<span class="_ _0"/>f.</div><div class="t m0 x3 h21 y1462 ff1 fs2 fc0 sc0 ls0 ws0">Figure 6-1<span class="_ _21"> </span><span class="ffc">User interaction with PHP-phoxy ser<span class="_ _1"/>ver</span></div><div class="t m0 x6b h3e y1463 ffd fs10 fc0 sc0 ls0 ws0">Server mangles HTML content to</div><div class="t m0 x76 h3e y1464 ffd fs10 fc0 sc0 ls0 ws0">ensure user connects to Phoxy</div><div class="t m0 xa3 h3e y1465 ffd fs10 fc0 sc0 ls0 ws0">for future request</div><div class="t m0 xc0 h3e y1466 ffd fs10 fc0 sc0 ls0 ws0">PHP-phoxy</div><div class="t m0 xc1 h3e y1467 ffd fs10 fc0 sc0 ls0 ws0">Server</div><div class="t m0 x2a h3e y1468 ffd fs10 fc0 sc0 ls0 ws0">Intended/Mirrored</div><div class="t m0 x10 h3e y1469 ffd fs10 fc0 sc0 ls0 ws0">Web Server</div><div class="t m0 x64 h3e y1468 ffd fs10 fc0 sc0 ls0 ws0">User Workstation</div><div class="t m0 x46 h3e y146a ffd fs10 fc0 sc0 ls0 ws0">User HTTP or HTTPS</div><div class="t m0 xc2 h3e y146b ffd fs10 fc0 sc0 ls0 ws0">session to PHP-phoxy</div><div class="t m0 xc3 h3e y146c ffd fs10 fc0 sc0 ls0 ws0">phoxy returns mangled HTML</div><div class="t m0 x69 h3e y146d ffd fs10 fc0 sc0 ls0 ws0">page to user</div><div class="t m0 xc4 h3e y146a ffd fs10 fc0 sc0 ls0 ws0">Server has separate session to</div><div class="t m0 x4a h3e y146b ffd fs10 fc0 sc0 ls0 ws0">legitimate target web server</div><div class="t m0 xc4 h3e y146c ffd fs10 fc0 sc0 ls0 ws0">Server returns requested page</div><a class="" href="https://code.google.com/p/php-proxy/"><div class="d m1" style="border-style:none;position:absolute;left:434.285714px;bottom:475.331822px;width:84.000000px;height:12.000000px;background-color:rgba(255,255,255,0.000001);"/></a><a class="" href="https://code.google.com/p/php-proxy/"><div class="d m1" style="border-style:none;position:absolute;left:94.452003px;bottom:459.609977px;width:86.000000px;height:12.000000px;background-color:rgba(255,255,255,0.000001);"/></a></div><div class="pi" data-data="{&#34;ctm&#34;:[1.209373,0.000000,0.000000,1.209373,0.000000,0.000000]}"/></div></div></body></html>