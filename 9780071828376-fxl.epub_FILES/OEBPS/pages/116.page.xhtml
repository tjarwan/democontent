<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml"><head><title/><link rel="stylesheet" href="../css/base.min.css"/><link rel="stylesheet" href="../css/fancy.min.css"/><link rel="stylesheet" href="../css/pdf.css"/><meta name="viewport" content="width=640, height=824"/></head><body><div id="page_body"><div id="pf74" class="pf w2 h2" data-page-no="74"><div class="pc pc74 w2 h2"><div class="t m0 x93 h10 y83 ff2 fs2 fc0 sc0 ls8 ws0">Chapter 4: An APT Approach to Reconnaissance <span class="_ _3f"> </span><span class="ff1 fs9 lsa">93</span></div><div class="t m0 x3 hd y11c ff4 fs7 fc0 sc0 lsb ws16">server responds with the record, we kno<span class="_ _0"/>w someone else at that or<span class="_ _0"/>ganization has </div><div class="t m0 x3 hd y11d ff4 fs7 fc0 sc0 ls0 ws0">requested that record pre<span class="_ _0"/>viously<span class="_ _2"/>. Even better<span class="_ _0"/>, we can observ<span class="_ _0"/>e the time to liv<span class="_ _0"/>e (TTL) </div><div class="t m0 x3 hd y20f ff4 fs7 fc0 sc0 ls0 ws0">of the record and calculate a relati<span class="_ _0"/>vely accurate time the record was pre<span class="_ _0"/>viously </div><div class="t m0 x3 hd y210 ff4 fs7 fc0 sc0 ls0 ws0">requested.</div><div class="t m0 x4 hd y120 ff4 fs7 fc0 sc0 ls0 ws0">This may not seem like a huge deal at rst, b<span class="_ _0"/>ut this can allo<span class="_ _0"/>w us to identify some </div><div class="t m0 x3 hd y121 ff4 fs7 fc0 sc0 ls0 ws0">useful information. First, if we can identify a set of websites that the DNS server has </div><div class="t m0 x3 hd y398 ff4 fs7 fc0 sc0 ls0 ws0">records cached for<span class="_ _0"/>, these websites can be perfect material to use during our phishing </div><div class="t m0 x3 hd y399 ff4 fs7 fc0 sc0 ls0 ws0">attacks. <span class="_ _0"/>W<span class="_ _3"/>e might also be able to identify business relationships, vendors, customers, </div><div class="t m0 x3 hd y3c6 ff4 fs7 fc0 sc0 ls0 ws0">etc., by observing the records that are cached.</div><div class="t m0 x4 hd y4b0 ff4 fs7 fc0 sc0 ls0 ws0">This is another prime area for you to think outside the box and ask yourself, </div><div class="t m0 x3 hd y126 ff4 fs7 fc0 sc0 ls0 ws0">“What websites might they be trying to access that w<span class="_ _0"/>ould be benecial for me to </div><div class="t m0 x3 hd y39a ff4 fs7 fc0 sc0 ls0 ws0">conrm?” Think outside the box, and be sure to tak<span class="_ _0"/>e your time here. <span class="_ _3"/>Y<span class="_ _3"/>ou also want </div><div class="t m0 x3 hd y39b ff4 fs7 fc0 sc0 ls0 ws0">to repeat this ov<span class="_ _0"/>er time and get a good measure of when these resources might be </div><div class="t m0 x3 hd y4b2 ff4 fs7 fc0 sc0 ls0 ws0">requested and ho<span class="_ _0"/>w often they are requested. </div><div class="t m0 x4 hd y4b3 ff4 fs7 fc0 sc0 ls0 ws0">Because we exploit this by sending DNS queries to the tar<span class="_ _0"/>get DNS server<span class="_ _2"/>, we </div><div class="t m0 x3 hd y39e ff4 fs7 fc0 sc0 ls0 ws0">only need UDP port 53 open to us. The ca<span class="_ _0"/>veat is that the DNS query we send must </div><div class="t m0 x3 hd y39f ff4 fs7 fc0 sc0 ls0 ws0">be marked as nonrecursi<span class="_ _0"/>ve so that if the DNS serv<span class="_ _0"/>er we query does not ha<span class="_ _0"/>ve the </div><div class="t m0 x3 hd y3a0 ff4 fs7 fc0 sc0 ls0 ws0">record cached, it will respond either with a list of DNS servers for us to query or </div><div class="t m0 x3 h3f y3a1 ff4 fs7 fc0 sc0 ls0 ws0">nothing at all. T<span class="_ _3"/>o test it manually<span class="_ _2"/>, we can use the <span class="fff">dig</span> command as in the following </div><div class="t m0 x3 hd y3a2 ff4 fs7 fc0 sc0 ls0 ws0">example.</div><div class="t m0 x4 hd y3a3 ff4 fs7 fc0 sc0 ls0 ws0">In this example, you can see we’<span class="_ _2"/>re querying the DNS server 8.8.8.8 for the host </div><div class="t m0 x3 hd y3a4 ff4 fs7 fc0 sc0 ls0 ws0">record for www<span class="_ _2"/>.facebook.com. <span class="_ _0"/>W<span class="_ _3"/>e specify that the server should not perform a </div><div class="t m0 x3 hd y3a5 ff4 fs7 fc0 sc0 ls0 ws0">recursi<span class="_ _0"/>ve query with the +norecurse option. <span class="_ _3"/>Y<span class="_ _1b"/>ou can test this yourself, as 8.8.8.8 is </div><div class="t m0 x3 hd y3a6 ff4 fs7 fc0 sc0 ls0 ws0">a public Google DNS server<span class="_ _2"/>. In this case, the Google server had the record cached </div><div class="t m0 x3 hd y3a7 ff4 fs7 fc0 sc0 ls0 ws0">because it returned it to us in the <span class="_ _2"/>Answer section.</div><div class="t m0 x3 h40 ya73 fff fs5 fc0 sc0 ls0 ws0">user@kali:$ dig @8.8.8.8 www.facebook.com A +norecurse</div><div class="t m0 x3 h40 ya74 fff fs5 fc0 sc0 ls0 ws0">; &lt;&lt;&gt;&gt; DiG 9.8.4-rpz2+rl005.12-P1 &lt;&lt;&gt;&gt; @8.8.8.8 www.facebook.com A +norecurse</div><div class="t m0 x3 h40 ya75 fff fs5 fc0 sc0 ls0 ws0">; (1 server found)</div><div class="t m0 x3 h40 ya76 fff fs5 fc0 sc0 ls0 ws0">;; global options: +cmd</div><div class="t m0 x3 h40 ya77 fff fs5 fc0 sc0 ls0 ws0">;; Got answer:</div><div class="t m0 x3 h40 ya78 fff fs5 fc0 sc0 ls0 ws0">;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 40789</div><div class="t m0 x3 h40 ya79 fff fs5 fc0 sc0 ls0 ws0">;; flags: qr ra; QUERY: 1, ANSWER: 2, AUTHORITY: 0, ADDITIONAL: 0</div><div class="t m0 x3 h40 ya7a fff fs5 fc0 sc0 ls0 ws0">;; QUESTION SECTION:</div><div class="t m0 x3 h40 ya7b fff fs5 fc0 sc0 ls0 ws0">;www.facebook.com.           IN    A</div><div class="t m0 x3 h40 ya7c fff fs5 fc0 sc0 ls0 ws0">;; ANSWER SECTION:</div><div class="t m0 x3 h40 ya7d fff fs5 fc0 sc0 ls0 ws0">www.facebook.com. 3356  IN    CNAME star.c10r.facebook.com.</div><div class="t m0 x3 h40 ya7e fff fs5 fc0 sc0 ls0 ws0">star.c10r.facebook.com. 16    IN    A    31.13.73.65</div><a class="" href="http://www.facebook.com"><div class="d m1" style="border-style:none;position:absolute;left:151.292517px;bottom:361.650794px;width:90.000000px;height:12.000000px;background-color:rgba(255,255,255,0.000001);"/></a></div><div class="pi" data-data="{&#34;ctm&#34;:[1.209373,0.000000,0.000000,1.209373,0.000000,0.000000]}"/></div></div></body></html>