<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml"><head><title/><link rel="stylesheet" href="../css/base.min.css"/><link rel="stylesheet" href="../css/fancy.min.css"/><link rel="stylesheet" href="../css/pdf.css"/><meta name="viewport" content="width=640, height=824"/></head><body><div id="page_body"><div id="pf117" class="pf w2 h2" data-page-no="117"><div class="pc pc117 w2 h2"><img class="bi x94 y1ab0 w6 h2e" alt="" src="bg117.png"/><div class="t m0 xbe h10 y83 ff1 fs9 fc0 sc0 lsa ws0">256<span class="_ _d"> </span><span class="ff2 fs2 ls8">Advanced Persistent Threat Hacking<span class="_ _1e"/> </span></div><div class="t m0 x4 hd y172 ff4 fs7 fc0 sc0 ls0 ws0">Not all of the attacks we’<span class="_ _2"/>re preparing have to work. In f<span class="_ _0"/>act, typically<span class="_ _2"/>, only one </div><div class="t m0 x3 hd y173 ff4 fs7 fc0 sc0 ls0 ws0">v<span class="_ _0"/>alid interactiv<span class="_ _0"/>e HTTP session from the user’<span class="_ _2"/>s browser can be enough to capture all </div><div class="t m0 x3 hd y19a ff4 fs7 fc0 sc0 ls0 ws0">of the credentials for our target systems, as well as completely compromise the client </div><div class="t m0 x3 hd y291 ff4 fs7 fc0 sc0 ls0 ws0">de<span class="_ _0"/>vice.</div><div class="t m0 x94 h2f y425 ffe fs9 fc0 sc0 ls0 ws0">NOTE</div><div class="t m0 x94 h14 y1ab1 ff9 fs7 fc0 sc0 ls0 ws0">The vast majority of these attacks will work for hardwired networks if you can get the same </div><div class="t m0 x94 h14 y1ab2 ff9 fs7 fc0 sc0 ls0 ws0">privileged status of being the DNS server or gateway for the user<span class="_ _2"/>. This doesn’t mean you have to </div><div class="t m0 x94 h14 y1ab3 ff9 fs7 fc0 sc0 ls0 ws0">be congured as the user’<span class="_ _2"/>s default gateway<span class="_ _0"/>, but if you can ensure your host will be routed through </div><div class="t m0 x94 h14 y1ab4 ff9 fs7 fc0 sc0 ls0 ws0">some point of the user’<span class="_ _2"/>s communication with end systems, you can execute the same attacks.</div><div class="t m0 x4 hd y1ab5 ff4 fs7 fc0 sc0 ls0 ws0">W<span class="_ _3"/>e can also kick off automatic port scans of clients once they associate to </div><div class="t m0 x3 hd y1ab6 ff4 fs7 fc0 sc0 ls0 ws0">our network to make sure there are no vulnerabilities with the client system that </div><div class="t m0 x3 hd y1ab7 ff4 fs7 fc0 sc0 ls0 ws0">could provide a quick w<span class="_ _0"/>ay to compromise the device, such as vulnerabilities lik<span class="_ _0"/>e </div><div class="t m0 x3 hd y1ab8 ff4 fs7 fc0 sc0 ls0 ws0">MS08_067, open le shares, or default credentials.</div><div class="t m0 x4 hd yad1 ff4 fs7 fc0 sc0 ls0 ws0">There are obvious adv<span class="_ _0"/>antages to relying on observing and manipulating client </div><div class="t m0 x3 hd yad2 ff4 fs7 fc0 sc0 ls0 ws0">network trafc. First, because the client is initiating the connections, a client re<span class="_ _0"/>wall </div><div class="t m0 x3 hd yad3 ff4 fs7 fc0 sc0 ls0 ws0">is almost meaningless. Second, the sheer number of network communications </div><div class="t m0 x3 hd y1ab9 ff4 fs7 fc0 sc0 ls0 ws0">will far outnumber the number of services of<span class="_ _0"/>fered on client de<span class="_ _0"/>vices, and the </div><div class="t m0 x3 hd y1aba ff4 fs7 fc0 sc0 ls0 ws0">vulnerabilities present in these network protocols are systemic and, in man<span class="_ _0"/>y cases, </div><div class="t m0 x3 hd y1abb ff4 fs7 fc0 sc0 ls0 ws0">intrinsic to these protocols.</div><div class="t m0 x3 h7 y1abc ff1 fs3 fc0 sc0 ls0 ws0">DNS and HTTP</div><div class="t m0 x3 hd y1abd ff4 fs7 fc0 sc0 ls0 ws0">The DNS server and HTTP serv<span class="_ _0"/>er are really part of the core functionality of our </div><div class="t m0 x3 hd y1abe ff4 fs7 fc0 sc0 ls0 ws0">rogue system. So many systems today rely on these tw<span class="_ _0"/>o protocols, and they pro<span class="_ _0"/>vide </div><div class="t m0 x3 hd y1abf ff4 fs7 fc0 sc0 ls0 ws0">an easy method for us to begin e<span class="_ _0"/>xploiting these systems since, by default, DNS and </div><div class="t m0 x3 hd y1ac0 ff4 fs7 fc0 sc0 ls0 ws0">HTTP are not encrypted or authenticated.</div><div class="t m0 x4 hd y1ac1 ff4 fs7 fc0 sc0 ls0 ws0">The DNS conguration is relati<span class="_ _0"/>vely straightforward. Since the client de<span class="_ _0"/>vices ha<span class="_ _0"/>ve </div><div class="t m0 x3 hd y1ac2 ff4 fs7 fc0 sc0 ls0 ws0">been congured via DHCP to use our host as their DNS server<span class="_ _2"/>, all requests will </div><div class="t m0 x3 hd y1ac3 ff4 fs7 fc0 sc0 ls0 ws0">legitimately come to us. F<span class="_ _0"/>or the most part, we will simply send DNS replies that </div><div class="t m0 x3 hd y1ac4 ff4 fs7 fc0 sc0 ls0 ws0">resolve all records to our access point. <span class="_ _0"/>The only time when the requests won’<span class="_ _0"/>t come </div><div class="t m0 x3 hd y1ac5 ff4 fs7 fc0 sc0 ls0 ws0">directly to us is if the client has statically congured DNS servers. Ev<span class="_ _0"/>en in this case, </div><div class="t m0 x3 hd y1ac6 ff4 fs7 fc0 sc0 ls0 ws0">though, we can redirect the request to our DNS server using iptables re<span class="_ _0"/>wall rules </div><div class="t m0 x3 hd y1ac7 ff4 fs7 fc0 sc0 ls0 ws0">and answer the request in the same way<span class="_ _2"/>.</div><div class="t m0 x4 hd y1ac8 ff4 fs7 fc0 sc0 ls0 ws0">The HTTP server conguration is similar in nature. <span class="_ _0"/>W<span class="_ _3"/>e’ll congure an <span class="_ _2"/>Apache </div><div class="t m0 x3 hd y1ac9 ff4 fs7 fc0 sc0 ls0 ws0">server to accept an<span class="_ _0"/>y requested URL and forward it to our main PHP processing page. </div><div class="t m0 x3 hd y1aca ff4 fs7 fc0 sc0 lsb ws16">This page will implement all of the attacks we choose against the user<span class="_ _2"/>. These attacks </div><div class="t m0 x3 hd y1acb ff4 fs7 fc0 sc0 ls0 ws16">include</div></div><div class="pi" data-data="{&#34;ctm&#34;:[1.209373,0.000000,0.000000,1.209373,0.000000,0.000000]}"/></div></div></body></html>